<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
PUBLIC "-//W3C//DTD XHTML 1.1//EN"
       "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><title>Test-Driven Markup | Inclusive Design Patterns</title><link rel="stylesheet" href="css/book.css" type="text/css"/><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/><meta name="EPB-UUID" content="24CC751A-5435-483D-851C-00DC23A33E17"/></head><body><div class="body"><h1>Test-Driven Markup</h1><p><a href="https://en.wikipedia.org/wiki/Test-driven_development"><span class="link">Test-driven development</span></a><sup><a href="#fn27_1"><span class="sup_link">1</span></a></sup> (TDD) allows developers working with frequent iterations to move forward with confidence. By writing tests first, to prescribe outcomes, then creating the functionality to achieve them, you can ensure successful builds behave in a predictable and reliable fashion. Thrill seekers who relish their &#8220;What the hell is going on?&#8221; moments may find TDD a little boring, but it&#8217;s a solid approach.</p><p>In application development, tests are usually written against functions and what those functions are expected to produce. For example, if I wanted to test that the <code>add()</code> function from my <em>add.js</em> Node.js module worked correctly, I could use <a href="https://mochajs.org"><span class="link">Mocha</span></a><sup><a href="#fn27_2"><span class="sup_link">2</span></a></sup> and the <a href="http://chaijs.com/"><span class="link">Chai</span></a><sup><a href="#fn27_3"><span class="sup_link">3</span></a></sup> assertion library:</p><pre><code class=" language-javascript"><span class="token keyword">var</span> expect <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>
<span class="token keyword">var</span> add <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'../lib/add.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

describe<span class="token punctuation">(</span><span class="token string">'Add module'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    describe<span class="token punctuation">(</span><span class="token string">'The add() function'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">(</span><span class="token string">'should give 4 when adding 3 to 1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>equal<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now I can just run <code>npm test</code> (or whatever alias I have set up) and I&#8217;ll find out if my function is doing what I hoped it would.</p><p>That&#8217;s all very well, but it&#8217;s designed for the largely imperative language of JavaScript. What if we could write similar tests for declarative languages like HTML? Then we could ensure the correct <em>structure of markup</em> as we write it as well. Since well-formed markup is a big contributor to web accessibility, a kind of TDD for markup can keep us from building uninclusive patterns.</p><p>It turns out there&#8217;s already a language perfectly suited for this task. Appropriately, it is itself a declarative language and, fortuitously, it does not take the form of an additional library dependency. I&#8217;m talking, of course, about CSS.</p><h2>The Logic Of Selectors</h2><p>Despite CSS being a declarative language, there is a logic in the formulation of selectors. Selectors are condition-based expressions which are used to match HTML structures. So good are CSS selectors at doing this that tools for <em>writing</em> markup like <a href="http://emmet.io/"><span class="link">Emmet</span></a><sup><a href="#fn27_4"><span class="sup_link">4</span></a></sup> are based on selector-like syntax. The inherent logic of CSS selectors becomes clear when you reimagine selectors in JavaScript syntax. For example, I might want to match all buttons that are not disabled:</p><pre><code class=" language-css"><span class="token selector">button:not(:disabled) </span><span class="token punctuation">{</span> &hellip; <span class="token punctuation">}</span></code></pre><p>Rewritten in JavaScript:</p><pre><code class=" language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>nodeName <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'button'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>element<span class="token punctuation">.</span>disabled<span class="token punctuation">)</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span></code></pre><p>Typically, CSS selectors are used to match expected patterns but, by the same token, we could use selectors to target broken or malformed patterns. Where these are present, an error style could be elicited to highlight the problem.</p><pre><code class=" language-css"><span class="token selector">[undesired pattern] </span><span class="token punctuation">{</span>
    <span class="token comment">/* error style, such as
    outline: 0.5em solid red;
    */</span>
<span class="token punctuation">}</span></code></pre><p>Now all we need is a method for describing the issue to the user on inspection of the highlighted element. Let&#8217;s see how this might work using a tab interface as our subject pattern.</p><h2>The Test-Driven Tab Interface</h2><p>I detail the formulation of accessible, ARIA-enhanced tab interfaces in my book, &#8220;<a href="https://shop.smashingmagazine.com/products/apps-for-all"><span class="link">Apps For All: Coding Accessible Web Applications</span></a><sup><a href="#fn27_5"><span class="sup_link">5</span></a></sup>.&#8221; Also available are a <a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="link">demo and explanation</span></a><sup><a href="#fn27_6"><span class="sup_link">6</span></a></sup>. If you&#8217;re not familiar with this integrated pattern and its expected behaviors, please refer to either of these resources.</p><p>The following code example sets out a tab interface as marked up in its initial state. Our job is to write tests against the elements&#8217; properties and relationships within the tab interface, to make sure it is structured as expected. With relatively complex patterns like tab interfaces, it&#8217;s easy to slip up and miss out or badly form part of the structure. This is our opportunity to stop that from happening.</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>"tab-interface"</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tablist"</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"presentation"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>"#panel1"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"tab1"</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tab"</span> <span class="token attr-name">aria-selected</span><span class="token attr-value"><span class="token punctuation">=</span>"true"</span><span class="token punctuation">&gt;</span></span>First Tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"presentation"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>"#panel2"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"tab2"</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tab"</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>"-1"</span><span class="token punctuation">&gt;</span></span>Second Tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"presentation"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>"#panel3"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"tab3"</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tab"</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>"-1"</span><span class="token punctuation">&gt;</span></span>Third Tab<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tabpanel"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"panel1"</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>"tab1"</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- tab panel 1 content --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tabpanel"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"panel2"</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>"tab2"</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- tab panel 2 content --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"tabpanel"</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>"panel3"</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>"tab3"</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- tab panel 3 content --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><h3>The Tests</h3><p>Let&#8217;s start from the top. I know that my tabs will only function correctly in assistive technologies if they belong to an element with the special <code>tablist</code> role to group the individual tabs. My selector should identify the <code>&lt;ul&gt;</code> element within the <code>class="tab-interface"</code> container and highlight it if it doesn&#8217;t have a <code>role="tablist"</code> attribute.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]) </span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Now, if no well-placed <code>tablist</code> semantics are present, an ugly red outline will appear on the list element.</p><p>As stated in <a href="https://www.w3.org/TR/wai-aria/roles#tablist"><span class="link">the <code>tablist</code> role specification</span></a><sup><a href="#fn27_7"><span class="sup_link">7</span></a></sup>, tablists <em>require</em> &#8220;owned elements&#8221; with the explicit <code>tab</code> role, in the form <code>role="tab"</code>. Some implementations place this attribute directly on each <code>&lt;li&gt;</code> element, but I prefer to use <code>&lt;a&gt;</code> elements so that the structure easily degrades as a list of links. See the &#8220;Navigation Regions&#8221; chapter for more on link lists and navigation.</p><p>Having decided that it is the <code>&lt;a&gt;</code> element which should take the <code>tab</code> role, I can add a corresponding test to my suite.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]) </span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Where JavaScript has added the tab interface semantics, the list semantics become redundant, which is why we suppress them with <code>role="presentation"</code> on each <code>&lt;li&gt;</code> element. This test selector follows similar logic to the previous test.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>In correctly behaving tab interfaces, there should always be one selected tab, defined accessibly using the <a href="http://w3c.github.io/aria/aria/aria.html#aria-selected"><span class="link"><code>aria-selected</code></span></a><sup><a href="#fn27_8"><span class="sup_link">8</span></a></sup> state. This should be the only element focusable by the user with the <em>Tab</em> key. All other tabs should take the <code>tabindex="-1"</code> attribute and be selectable using only the arrow keys. This requires two more test selectors. The second is essentially a negated version of the first.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"]),
[role="tablist"] a[aria-selected][tabindex="-1"],
[role="tablist"] a:not([aria-selected]):not([tabindex="-1"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>We can even detect incorrect patterns used to formulate the <code>tabpanel</code> <code>aria-labelledby</code> attribute values. The additional test selector in the following example matches tab panels with the correct role, but with an <code>aria-labelledby</code> value not commencing with &#8220;tab.&#8221; This fuzzy matching is possible using the <em>starts with</em> <code>^</code> modifier in the attribute selector, <code>[aria-labelledby^="tab"]</code>.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"]),
[role="tablist"] a[aria-selected][tabindex="-1"],
[role="tablist"] a:not([aria-selected]):not([tabindex="-1"]),
[role="tabpanel"]:not([aria-labelledby^="tab"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Of course, this catches the complete absence of <code>aria-labelledby</code> as well.</p><p>Finally, let&#8217;s make sure all the tab panels have the <code>tabpanel</code> role. We know that the tab panel set should appear after the list, so we can use the <a href="https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors"><span class="link">general sibling combinator</span></a><sup><a href="#fn27_9"><span class="sup_link">9</span></a></sup> <code>&#126;</code> in this test to ask if there are any <code>&lt;div&gt;</code>s following the <code>tablist</code> that are <em>not</em> <code>tabpanel</code>s.</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"]),
[role="tablist"] a[aria-selected][tabindex="-1"],
[role="tablist"] a:not([aria-selected]):not([tabindex="-1"]),
[role="tabpanel"]:not([aria-labelledby^="tab"]),
[role="tablist"] ~ div:not([role="tabpanel"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Having content between the <code>tablist</code> and tab panels would fragment the interface and cause confusion. As an accompaniment to the last test, we can make sure a <code>&lt;div&gt;</code> with the <code>tabpanel</code> role is the first sibling element after the <code>tablist</code>. This test selector uses the <a href="https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors"><span class="link">adjacent sibling combinator</span></a><sup><a href="#fn27_10"><span class="sup_link">10</span></a></sup> (or next-sibling selector) <code>&#43;</code>:</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"]),
[role="tablist"] a[aria-selected][tabindex="-1"],
[role="tablist"] a:not([aria-selected]):not([tabindex="-1"]),[role="tabpanel"]:not([aria-labelledby^="tab"]),
[role="tablist"] ~ div:not([role="tabpanel"]),
[role="tablist"] + div:not([role="tabpanel"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3>Error Messages</h3><p>So far, we&#8217;ve provided a red outline for any elements which match undesired patterns. But that&#8217;s not much use unless we also provide an explanation of the error. In the experimental CSS testing bookmarklet <a href="http://heydonworks.com/revenge_css_bookmarklet/"><span class="link">revenge.css</span></a><sup><a href="#fn27_11"><span class="sup_link">11</span></a></sup>, I used test selectors to identify generic accessibility-related markup errors and provided error messages using pseudo-content. For example, the following prints a lurid message for lists which are badly formed:</p><pre><code class=" language-css"><span class="token selector">ol &gt; *:not(li)::after,
ul &gt; *:not(li)::after </span><span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'Only &lt;li&gt; can be a direct child of &lt;ul&gt; or &lt;ol&gt;.'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>However, actually printing that error to the screen is fraught with problems. Since it piggybacks a site&#8217;s own CSS, I had to be very careful about overriding certain styles for pseudo-content that would mess up the appearance and readability of the error messages. Where there are errors for successive sibling elements (like the erroneous <code>&lt;li&gt;</code> replacements the last example is designed to detect) space becomes an issue too.</p><p><a href="https://ffoodd.github.io/a11y.css/"><span class="link">A11y.css</span></a><sup><a href="#fn27_12"><span class="sup_link">12</span></a></sup> &mdash; a more advanced CSS accessibility testing tool by <a href="https://twitter.com/ffoodd_fr"><span class="link">Ga&euml;l Poupard</span></a><sup><a href="#fn27_13"><span class="sup_link">13</span></a></sup> &mdash; overcomes this by positioning each pseudo-content message at the top of the document and reveals it on hover.</p><p>But why bother showing the error messages within the page itself at all? Instead, I can use the developer tools CSS inspector like a JavaScript console and provide the error messages there. The red outline should remain, but only as an indicator of which elements the developer should be inspecting.</p><p>In which case, I could just hide the pseudo-content message with <code>display:none;</code>:</p><p><img src="images/dev_tools_1.png" alt="Screenshot of dev tools declaration block with a display:none; declaration above the content declaration." /><br /><em>Screenshot of devtools declaration block with <code>display: none;</code> declaration above the content declaration.</em></p><p>There are a couple of small issues here. The first is that when two errors apply to the same element, all but the last in the cascade will be grayed out (with a line-through style) in the CSS inspector. That is, it looks misleadingly as if all but the last error is not applicable. The other is that <code>display:none;</code> is supplemental to the error message &mdash; unnecessary noise.</p><h4>The ERROR Property</h4><p>The is no such thing as the <code>ERROR</code> property in CSS and there are no plans for one &mdash; let me make that clear right away!But there are a few benefits to using an unrecognized CSS property to log errors to the CSS inspector. The first is that pseudo-content becomes entirely redundant, along with the <code>display:none;</code> property, reducing an individual CSS error to this:</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> The tab interface <span class="token ignore">&lt;</span>ul<span class="token ignore">&gt;</span> must have the tablist WAI-ARIA role
<span class="token punctuation">}</span></code></pre><p>Second, as an unrecognized property it is not entered into specificity calculations. Depending on the browser, this either means no more graying out, or a grayed-out style for <em>all</em> <code>ERROR</code> declarations: a slight improvement. My favorite part is that the Chrome browser&#8217;s way of highlighting unrecognized properties is to prefix them with a little warning sign (&#8220;&#9888;&#8221;). We automatically co-opt this sign to help highlight our errors, producing something like this:</p><p><img src="images/dev_tools_2.png" alt="A declaration block from Chrome dev tools showing the error declaration with a line-through style." /><br /><em>A declaration block from Chrome dev tools showing the error declaration with a line-through style.</em></p><p>Unfortunately, like overriden declarations, unrecognized declarations still take a line-through style as illustrated. For my money, this isn&#8217;t a deal-breaker because the capitalized <code>ERROR</code> property name picks these declarations out quite clearly. Nonetheless, with the help of <a href="https://twitter.com/dansketchpad"><span class="link">Dan Smith</span></a><sup><a href="#fn27_14"><span class="sup_link">14</span></a></sup>, I can provide a <a href="https://github.com/Heydon/css-error-property-style/blob/master/README.md"><span class="link">small Chrome extension</span></a><sup><a href="#fn27_15"><span class="sup_link">15</span></a></sup> for removing this line-through style and replacing it with a more error-like white-on-red appearance:</p><p><img src="images/dev_tools_3.png" alt="The error declaration has a red box behind it and white text. The warning sign is still present." /><br /><em>Note that it&#8217;s no longer necessary to encapsulate the error in single quotation marks as a string.</em></p><p>Be aware that this style will be honored by any declaration using an unrecognized property. However, thanks to the extension&#8217;s omission of the <code>.has-ignorable-error</code> class, the most common unrecognized properties &mdash; browser prefixes &mdash; are not styled this way.</p><pre><code class=" language-css"><span class="token selector">.overloaded.not-parsed-ok.inactive:not(.has-ignorable-error) </span><span class="token punctuation">{</span>
    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.overloaded.not-parsed-ok.inactive:not(.has-ignorable-error) .webkit-css-property </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3>Putting It Together</h3><p>Our tab interface pattern should now have a <em>tab-interface.css</em> file and, in an effort to establish a naming convention, an accompanying <em>tab-interface.test.css</em> file &mdash; something like this:</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role="tablist"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"The tab interface &lt;ul&gt; must have the tablist WAI-ARIA role to be recognized in assistive technologies."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] a:not([role="tab"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"&lt;a&gt; elements within the tablist need to each have the WAI-ARIA tab role to be counted as tabs in assistive technologies."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] li:not([role="presentation"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"Remove the &lt;li&gt; semantics with the WAI-ARIA presentation role. Where the tab interface is instated, these semantics are irrelevant."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] a[aria-selected][tabindex="-1"] </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"Remove the -1 tabindex value on the aria-selected tab to make it focusable by the user. They should be able to move to this tab only."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] a:not([aria-selected]):not([tabindex="-1"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"All unselected tabs should have the -1 tabindex value and only be focusable using the left and right arrow keys."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tabpanel"]:not([aria-labelledby^="tab"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"Each tabpanel should have an aria-labelledby attribute starting with "tab" followed by the corresponding tab’s number. This is the convention of tab systems in our interface."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] ~ div:not([role="tabpanel"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"Each tabpanel needs to have the explicit tabpanel WAI-ARIA role to be correctly associated with the tablist that controls it."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role="tablist"] + div:not([role="tabpanel"]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">"The first element after the tablist should be a tab panel with the tabpanel WAI-ARIA role. Screen reader users must be able to move directly into the open tab panel from the selected tab."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.tab-interface ul:not([role="tablist"]),
[role="tablist"] a:not([role="tab"]),
[role="tablist"] li:not([role="presentation"]),
[role="tablist"] a[aria-selected][tabindex="-1"],
[role="tablist"] a:not([aria-selected]):not([tabindex="-1"]),[role="tabpanel"]:not([aria-labelledby^="tab"]),
[role="tablist"] ~ div:not([role="tabpanel"]),
[role="tablist"] + div:not([role="tabpanel"])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Of course, none of this can technically <em>fail</em> a build in its current form; it just highlights errors visually, for the front-end developer to see. However, the <em>.test.css</em> files certainly don&#8217;t want to be included in production. Using the <em>.test.css</em> convention helps when it comes to omit them from being copied to your production build folder.</p><h2>Not One-Size-Fits-All</h2><p>The difference between this test-driven markup approach and standard automated accessibility testing is clear: whether using a CSS-based bookmarklet like <a href="https://ffoodd.github.io/a11y.css/"><span class="link">a11y.css</span></a><sup><a href="#fn27_16"><span class="sup_link">16</span></a></sup> or an advanced API like <a href="http://tenon.io/"><span class="link">tenon.io</span></a><sup><a href="#fn27_17"><span class="sup_link">17</span></a></sup>, generic errors are disclosed. This testing is important, especially for WCAG compliance. But writing your own tests for your own tailored patterns and structures means you can be more granular and specific about their expected form.</p><p>Implementations of tab interfaces can differ. For instance, the relationship between the tabs and their panels can be achieved using <code>aria-controls</code> rather than <code>aria-labelledby</code>. The tests written here ensure that <em>my</em> implementation &mdash; my specific pattern &mdash; is structured in the prescribed way. Where additional JavaScript and CSS hooks (<code>data</code> and <code>class</code> attributes) should be present, this is also an opportunity to test for them.</p><p>As you develop your own library of inclusive design patterns, I recommend you try writing some tests like these. As the pattern evolves over time and between colleagues, you can make sure its integrity remains intact. Where an error does emerge, you will have taken the opportunity &mdash; via the error message &mdash; to explain your decision-making and how the structure you&#8217;ve chosen makes the markup inclusive.</p><div class="fn_overview"><p class="separator">—</p><p id="fn27_1"><span class="fn_number">1.</span><a href="https://en.wikipedia.org/wiki/Test-driven_development"><span class="fn_link">https://en.wikipedia.org/wiki/Test-driven_development</span></a></p><p id="fn27_2"><span class="fn_number">2.</span><a href="https://mochajs.org"><span class="fn_link">https://mochajs.org</span></a></p><p id="fn27_3"><span class="fn_number">3.</span><a href="http://chaijs.com/"><span class="fn_link">http://chaijs.com/</span></a></p><p id="fn27_4"><span class="fn_number">4.</span><a href="http://emmet.io/"><span class="fn_link">http://emmet.io/</span></a></p><p id="fn27_5"><span class="fn_number">5.</span><a href="https://shop.smashingmagazine.com/products/apps-for-all"><span class="fn_link">https://shop.smashingmagazine.com/products/apps-for-all</span></a></p><p id="fn27_6"><span class="fn_number">6.</span><a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="fn_link">http://heydonworks.com/practical_aria_examples/#tab-interface</span></a></p><p id="fn27_7"><span class="fn_number">7.</span><a href="https://www.w3.org/TR/wai-aria/roles#tablist"><span class="fn_link">https://www.w3.org/TR/wai-aria/roles#tablist</span></a></p><p id="fn27_8"><span class="fn_number">8.</span><a href="http://w3c.github.io/aria/aria/aria.html#aria-selected"><span class="fn_link">http://w3c.github.io/aria/aria/aria.html#aria-selected</span></a></p><p id="fn27_9"><span class="fn_number">9.</span><a href="https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors"><span class="fn_link">https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors</span></a></p><p id="fn27_10"><span class="fn_number">10.</span><a href="https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors"><span class="fn_link">https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors</span></a></p><p id="fn27_11"><span class="fn_number">11.</span><a href="http://heydonworks.com/revenge_css_bookmarklet/"><span class="fn_link">http://heydonworks.com/revenge_css_bookmarklet/</span></a></p><p id="fn27_12"><span class="fn_number">12.</span><a href="https://ffoodd.github.io/a11y.css/"><span class="fn_link">https://ffoodd.github.io/a11y.css/</span></a></p><p id="fn27_13"><span class="fn_number">13.</span><a href="https://twitter.com/ffoodd_fr"><span class="fn_link">https://twitter.com/ffoodd_fr</span></a></p><p id="fn27_14"><span class="fn_number">14.</span><a href="https://twitter.com/dansketchpad"><span class="fn_link">https://twitter.com/dansketchpad</span></a></p><p id="fn27_15"><span class="fn_number">15.</span><a href="https://github.com/Heydon/css-error-property-style/blob/master/README.md"><span class="fn_link">https://github.com/Heydon/css-error-property-style/blob/master/README.md</span></a></p><p id="fn27_16"><span class="fn_number">16.</span><a href="https://ffoodd.github.io/a11y.css/"><span class="fn_link">https://ffoodd.github.io/a11y.css/</span></a></p><p id="fn27_17"><span class="fn_number">17.</span><a href="http://tenon.io/"><span class="fn_link">http://tenon.io/</span></a></p></div></div></body></html>
