<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
PUBLIC "-//W3C//DTD XHTML 1.1//EN"
       "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xml:lang="ja" xmlns="http://www.w3.org/1999/xhtml"><head><title>9章：フィルターウィジェット</title><link rel="stylesheet" href="css/book.css" type="text/css"/><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><meta name="EPB-UUID" content="24CC751A-5435-483D-851C-00DC23A33E17"/></head><body><div class="body"><h1>フィルターウィジェット</h1><p>9章「商品リスト」は、商業的な面に目を向け、商品を陳列するためのパターンについて考察しました。どのように個々の商品コンポーネントをマークアップし、どのようにそれら全体をグループ化するかということは、いずれも、インクルーシブデザインと深い関係がありました。さらに、検索エンジンの検索結果など、自身のサイト<em>以外</em>のインターフェイスにも、アクセシブルな情報を潤沢に含めることができるようにしました。</p><p>しかし、ユーザーがコンテンツのリストを並べ替えたり、表示を制御したりするツールについては、まだ扱っていませんでした。フィルターツールは、検索結果の機能の軸を増やします。表示をユーザーがコントロールできるようになり、見ている情報に優先順位をつけやすくなります。<em>ユーザーに制御させる</em>、というのは、先に紹介したヘニー・スワンの原則の2番目の項目でした。</p><p class="list"><span class="digit">1. </span>ユーザーに選択肢を与える。</p><p class="list"><span class="digit">2. </span><strong>ユーザーに制御させる。</strong></p><p class="list"><span class="digit">3. </span>なじみやすさを念頭に置いてデザインする。</p><p class="list last-item"><span class="digit">4. </span>価値を付加する機能を優先する。</p><p>前述したナビゲーション領域と同様、フィルターウィジェットも<em>メタ</em>的であり、ページのコンテンツを変更する機能を提供するコンテンツとなります。これをインクルーシブにするためには、目の不自由なユーザーやキーボードユーザー、パフォーマンスの潜在的な問題、見た目の明確さについて考慮する必要があります。</p><p>このパターンではプログレッシブエンハンスメントを基礎としています。CSSとJavaScriptなしでも機能するように作ってから、これら2つの技術をそれぞれ少しずつ適用して、体験がさらにインクルーシブになるように拡張していきます。</p><h2>見た目の例</h2><p><img src="images/filter.png" alt="並べ替えというラベル、オプション（新着順、人気順、価格の安い順、価格の高い順）、および並べ替えるボタンが黒い枠の中に横並びで表示されている。選択されたフィルターは青の枠で囲まれている。" /></p><p>選択されたコントロールが色に依存しない方法でハイライトされており、これによって、色覚障害やロービジョンのユーザーにも、どのオプションが選択されているか判別できることに注目してください。</p><h2>マークアップ</h2><p>一部の複雑なJavaScriptウィジェット、例えば<a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="link">タブインターフェイス</span></a><sup><a href="#fn23_1"><span class="sup_link">（脚注156）</span></a></sup>などは、キーボードやスクリーンリーダーに対してアクセシブルにするために、WAI-ARIAによるセマンティクスの追加と、（JavaScriptによる）キーボードバインディングのカスタマイズを必要とします。ただし、<a href="https://www.w3.org/TR/aria-in-html/#first-rule-of-aria-use"><span class="link">Using ARIAのFirst rule of ARIA use</span></a><sup><a href="#fn23_2"><span class="sup_link">（脚注157）</span></a></sup>には、以下のように書かれています。</p><blockquote class="blockquote-regular"><p><em><em>必要なセマンティクスや動作が<strong>組み込まれた</strong>ネイティブのHTML要素や属性が存在する場合は、要素の転用とARIAのロール、ステート、プロパティの追加でアクセシブルにする代わりに、<strong>ネイティブのものを使用します</strong>。</em></em></p></blockquote><p>ブラウザによって実現されている標準のインタラクティブ機能の方が、JavaScriptによって作られたものよりもパフォーマンスに優れ、堅牢です。標準の機能が使えるならそれを使うべきで、使えるかどうか調査する価値はあります。</p><p>たいていの問題は、HTMLに標準で用意されているフォーム関連要素のふるまいをうまく利用することで解決できます。都合のよいことに、これらの要素には特有のセマンティクス、キーバインディング、ふるまいが最初から組み込まれています。JavaScriptが利用できる（できるかもしれない）からといって、それを使って<a href="http://www.heydonworks.com/article/reinventing-the-hyperlink"><span class="link">車輪の再発明</span></a><sup><a href="#fn23_3"><span class="sup_link">（脚注158）</span></a></sup>をするべきということではないのです。</p><p>ともあれ、並び替えウィジェットを用意しましょう。並び替えのオプションはそれぞれユニークなラベルを持ち、どれか一つだけが選択できるようになっています。これらのオプションはひとつのグループとしてまとめられ、共通のラベルがつけられています。この構造は、<code>&lt;fieldset></code>、<code>&lt;legend></code>、ラジオボタンを使って作成できます。9章「商品リスト」に引き続き、商品を扱っていると想定するなら、ウィジェットは以下のようになるでしょう。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;form&quot;</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sorter&quot;</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;get&quot;</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>並べ替え<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span> <span class="token attr-name">checked</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span><span class="token punctuation">></span></span>新着順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;popularity&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;popularity&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;popularity&quot;</span><span class="token punctuation">></span></span>人気順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-low-high&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-low-high&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-low-high&quot;</span><span class="token punctuation">></span></span>価格の安い順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-high-low&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-high-low&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-high-low&quot;</span><span class="token punctuation">></span></span>価格の高い順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;submit&quot;</span><span class="token punctuation">></span></span>並べ替える<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><h3>補足</h3><p class="list"><span class="bullet">•</span><code>&lt;form></code>に<code>form</code>というARIA roleを指定しているのは意外に思うかもしれませんが、これによってウィジェットがひとつの領域になり、スクリーンリーダーでショートカットを使ってナビゲーションできるようになります。このウィジェットの基本機能はJavaScriptなしでも動作しますが、その場合はページが再読み込みされ、ユーザーはページの先頭に戻されてしまいます。この指定があれば、フォームにすぐに戻ってくることができます。</p><p class="list"><span class="bullet">•</span>この<code>&lt;form></code>は「並べ替え」ラベル以下のラジオボタンをグループ化する<code>&lt;fieldset></code>をひとつ含み、その後に送信ボタンが続きます。ラジオボタンの<code>&lt;input></code>にフォーカスがあたると、<code>&lt;legend></code>の内容が読まれ、続いて<code>&lt;input></code>に対応する<code>&lt;label></code>が読み上げられます。初期状態では、先頭のオプション（「新着順」）がチェックされた状態になっています。ブラウザの標準動作では、このチェックされた&lt;input>だけがTabキーでフォーカス可能です。フォーカスすると、「並べ替え グループ、新着順 ラジオボタン、チェックされています、全4個中1個」のように読み上げられるでしょう。「並べ替え」はグループのラベル、「新着順」は要素のラベル、「チェックされています」は要素の状態（state）、「ラジオボタン」は要素の役割（role）を表しています。4という数字は、同じ<code>name=&quot;sort-method&quot;</code>を共有するラジオボタンの総数です。</p><p class="list"><span class="bullet">•</span>ブラウザは、異なるオプションを選択する機能を（上下左右の）矢印キーに担わせています。たとえば右矢印キーを押すと、次のname=&quot;sort-method&quot;属性を持つラジオボタン――「人気順」にフォーカスが移り、選択されます。スクリーンリーダーでは「並べ替え グループ、人気順 ラジオボタン、チェックされています、全4個中1個」のように読み上げられるでしょう。ちなみに、「並べ替え」はどのラジオボタンを選択しても読み上げられます。このウィジェットからいったん離れて他の要素を見てまわっても、ここに戻れば「並べ替え」と読まれます。これにより、現在選択されているオプションがどれであっても、これが並べ替え機能であることがすぐにわかります。</p><p class="list last-item"><span class="bullet">•</span>この段階では、<code>get</code>メソッドでフォームを送信してサーバー側でページを再表示しています。クライアント側のJavaScriptには依存していません。たとえば、人気順のオプションを選択してフォームを送信すると、<code>?sort-method=popularity</code>というクエリパラメータがついた状態でページが表示されます。後の「JavaScriptによる改善」セクションで、JavaScriptを用いて体験を拡張していきます。</p><h2>CSSによる拡張</h2><p>この並び替えウィジェットは、慣習的で広くサポートされているマークアップによってデザインされているため、すでにキーボードユーザーとスクリーンリーダーユーザーにとってアクセシブルになっています。また、JavaScriptに依存することなく操作可能で、推測しやすく、なじみのあるフォームになっています。</p><p>標準のラジオボタンは、本質的にインクルーシブではありますが、スタイルの調整が難しいという問題があります。これが、標準のラジオボタンを使わずに、まったくアクセシブルではない<code>&lt;div></code>や<code>&lt;span></code>ベースの解決策や、比較的複雑で問題が起こりやすいWAI-ARIAの実装を選んでしまう主な原因になっています。</p><p>しかし、「<a href="http://www.sitepoint.com/replacing-radio-buttons-without-replacing-radio-buttons/"><span class="link">Replacing Radio Buttons Without Replacing Radio Buttons</span></a><sup><a href="#fn23_4"><span class="sup_link">（脚注159）</span></a></sup>」にも書きましたが、実際に<code>&lt;input type=&quot;radio&quot;></code>要素に直接スタイルを適用<em>しなければならない</em>わけではありません。ラジオボタンを隠し、代わりに<code>&lt;label></code>にスタイルをつければよいのです。</p><p>以下の構造では、<code>for</code>と<code>id</code>によって関連づけが行われており、<code>&lt;label></code>をクリックする（もしくは押す）と、関連づけられた<code>&lt;input></code>を操作したことになります。つまり、<code>&lt;label></code>は<code>&lt;input></code>のクリック領域を拡張します。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span> <span class="token attr-name">checked</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span><span class="token punctuation">></span></span>新着順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre><p>こうすることで、タッチユーザーに対して、より大きく、より人間工学的に優れたヒットエリアを提供できます。それだけでなく、CSSを使って<code>&lt;input></code>の<code>:focus</code>と<code>:checked</code>の状態を表現することもできます。隣接セレクタを使って、状態をラベルに<em>そのまま引き継いでいる</em>ことに注目してください。</p><pre><code class=" language-css"><span class="token selector">[type=&quot;radio&quot;] + label </span><span class="token punctuation">{</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
    <span class="token comment">/* その他、基本のスタイル */</span>
<span class="token punctuation">}</span>

<span class="token selector">[type=&quot;radio&quot;]:focus + label </span><span class="token punctuation">{</span>
    <span class="token comment">/* フォーカス時のスタイル */</span>
<span class="token punctuation">}</span>

<span class="token selector">[type=&quot;radio&quot;]:checked + label </span><span class="token punctuation">{</span>
    <span class="token comment">/* 選択時のスタイル */</span>
<span class="token punctuation">}</span></code></pre><p>これで、インタラクションや視覚的なフィードバックをすべてラベルに引き受けてもらうことができたので、融通の利かない見苦しいラジオボタンを安心して隠すことができます。</p><pre><code class=" language-css"><span class="token selector">.sorter [type=&quot;radio&quot;] </span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 1px <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 1px <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span>0 <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span>0 <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">overflow</span><span class="token punctuation">:</span> hidden <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">clip</span><span class="token punctuation">:</span> rect(1px, 1px, 1px, 1px)<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>要約すると、HTMLとCSSで実現できることを、JavaScriptとWAI-ARIAで埋め合わせてはいけない、ということです。マーク・オットー（Mark Otto）の「<a href="http://wtfforms.com/"><span class="link">WTF, forms?</span></a><sup><a href="#fn23_5"><span class="sup_link">（脚注160）</span></a></sup>」では、このようなCSSによる拡張を、チェックボックス、<code>&lt;select></code>要素、ファイル入力 (input type=&quot;file&quot;) に対して行う方法を紹介しています。</p><h2>JavaScriptによる拡張</h2><p>このパターンはすでに必要な機能を全て備えており、かつ堅牢です。ただ、少しばかり<em>ぎこちない</em>と言えるでしょう。ユーザーがJavaScriptを利用できる場合は、可能な限り体験を拡張すべきです。ただし、JavaScriptが利用できるからといって、調子に乗って、すべてを捨てて書き直すべきだということではありません。もう土台はしっかりしています。すでにJavaScriptなしで問題なく動いている部分を、JavaScriptで作り直す必要は全くありません。</p><p>現状では、ユーザーが別のフィルタオプションを選択して並べ替えボタンを押すと、そのたびにページが再読み込みされます。これがスクリーンリーダーユーザーとキーボードユーザーにとって何を意味するか、もうおわかりでしょう。操作していた箇所にたどり着くために、このページの情報をもう一度全部聞かされたり、ドキュメントの前置き部分をすべて通過してきたりしなければなりません。あるいは、その両方ということもあります。</p><p>可能な限り、<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><span class="link">XHR</span></a><sup><a href="#fn23_6"><span class="sup_link">（脚注161）</span></a></sup>を利用してリストを再表示することを心がけるべきです。そうすることで、ページをリロードせずに新しいコンテンツを追加することができます。キーボードに頼っているユーザーは、操作していた（フォーカスが残ったままの）ウィジェットから、そのままコンテンツの操作を続けることできます。</p><h3>読み込み待ち</h3><p>コンテンツが処理中であり、表示に時間がかかることをユーザーに伝えるのは、以下のような、どこでも見かける読み込み中アイコンの役どころです。</p><p><img src="images/loading.png" alt="読み込み中であることを示す円形のグラフィックと、「商品リストを読み込み中…」というテキスト。" /></p><p>問題は、これを確認できるのは目が見えているユーザーだけだということです。コンテンツの読み込みが完了したことをスクリーンリーダーユーザーにも伝えるのは重要なことです。そうしないと、ユーザーは並べ替えボタンを押しても何も起きなかったのかと思い、さまよい続けることになりかねません。</p><p>WAI-ARIAの仕様は、このような状況のために<a href="http://w3c.github.io/aria/practices/aria-practices.html#LiveRegions"><span class="link">ライブリージョン</span></a><sup><a href="#fn23_7"><span class="sup_link">（脚注162）</span></a></sup>を提供しています。通常、コンテンツがスクリーンリーダーで読み上げられるのは、以下の場合のみです。</p><p class="list"><span class="bullet">•</span>要素が、ユーザーまたはプログラムによってフォーカスされているとき。</p><p class="list last-item"><span class="bullet">•</span>ユーザーがスクリーンリーダーのナビゲーションコマンドを使って、ある要素に移動したとき（たとえば、NVDAでは数字の「<em>9</em>」のキーを押すと次の行を読み上げます）。</p><p>しかしライブリージョンを使った場合、単純に、その中身のコンテンツが変更されたタイミングで読み上げられるようになります。これはつまり、スクリーンリーダーユーザーをページ内の現在位置から移動させなくても状況を説明できるということです。並べ替えボタンを押した後、ライブリージョンに「商品リストを読み込み中。しばらくお待ちください。」というメッセージを入れます。Loading products.”</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">aria-live</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;assertive&quot;</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;alert&quot;</span><span class="token punctuation">></span></span>
    商品リストを読み込み中。しばらくお待ちください。Loading products.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><p>そして、商品リストが読み込まれたら、ライブリージョンのコンテンツを変更して、ユーザーに以下のように知らせます。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">aria-live</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;assertive&quot;</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;alert&quot;</span><span class="token punctuation">></span></span>
    商品リストの読み込みが完了しました。23点の商品が一覧されています。23 products listed.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h4>補足</h4><p class="list"><span class="bullet">•</span><a href="http://w3c.github.io/aria/aria/aria.html#aria-live"><span class="link"><code>aria-live=&quot;polite&quot;</code></span></a><sup><a href="#fn23_8"><span class="sup_link">（脚注163）</span></a></sup>プロパティと<a href="http://w3c.github.io/aria/aria/aria.html#status"><span class="link"><code>status</code></span></a><sup><a href="#fn23_9"><span class="sup_link">（脚注164）</span></a></sup>ロールは同じ機能を提供します。両者はプラットフォームやスクリーンリーダー間の互換性を最大限にするために提供されています（一部の環境では、どちらか一方だけが認識されます）。</p><p class="list"><span class="bullet">•</span>以下のようなJavaScriptによる単純なDOM操作で、ライブリージョンにメッセージを入れることができます。<code>liveElement.textContent = &#39;メッセージ&#39;</code></p><p class="list"><span class="bullet">•</span><code>aria-live=&quot;assertive&quot;</code>と<code>alert</code>ロールは同じ機能を提供します。ライブリージョンに新しいメッセージが入ると、スクリーンリーダーの現在の読み上げが中断されて、メッセージが読み上げられます。つまり、ユーザーがウィジェットから離れて別のコンテンツを読んでいても、商品リストの読み込みが完了したことが即座に通知されます。かわりに<code>aria-live=polite</code>と<code>status</code>ロールを使った場合は、スクリーンリーダーが読み上げ中のコンテンツを読み終えた後に、ライブリージョンのコンテンツが読み上げられます。</p><p class="list"><span class="bullet">•</span>アプリケーションの通知の場合は、視覚的なメッセージの役割も兼ねるように、ライブリージョンにスタイルを適用して表示する必要があります。しかし、読み込み中アイコンを使う場合、それが表示されることで（そして、読み込みが完了すると消えることで）、すでに必要な情報を伝えています。こうしたケースでは、ライブリージョンを隠して、非視覚的にのみ利用されるようにします。ここでも、<a href="http://snook.ca/archives/html_and_css/hiding-content-for-accessibility"><span class="link">スクリーンリーダーでアクセシブルな非表示方法</span></a><sup><a href="#fn23_10"><span class="sup_link">（脚注165）</span></a></sup>を使用します。</p><p class="list last-item"><span class="bullet">•</span>Dequeが提供する<a href="https://dequeuniversity.com/library/aria/content-feedback/liveregion-playground"><span class="link">Live Region Playground</span></a><sup><a href="#fn23_11"><span class="sup_link">（脚注166）</span></a></sup>では、ライブリージョンのさまざまな設定を試すことができます。Macユーザーであれば、SafariでLive Region Playgroundを開き、VoiceOverをオンにする（<em>Cmd</em> + <em>F5</em>）ことで簡単にテストを開始できます。</p><h3>submitボタンをなくすべきか</h3><p>JavaScriptで商品リストを表示する場合、フォームを<code>get</code>で送信する機能は使いません。そのため、submitボタンのデフォルトの動作であるフォーム送信の機能を抑止して、ページが再読み込みされることを防ぐ必要があります。<code>submit</code>イベントの中でpreventDefault()を呼ぶことで実現できます。</p><pre><code class=" language-javascript"><span class="token keyword">var</span> sortForm <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">&#39;.sorter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sortForm<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">&#39;submit&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// XHRで処理するため、</span>    <span class="token comment">// ブラウザがフォームを送信しないようにする</span>    event<span class="token punctuation">.</span>preventDefault<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ここでXHR処理
</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>これに対して、そもそもsubmitボタンが必要なのか、という疑問も出てくるでしょう。おそらく、JavaScriptでsubmitボタンを取り除き、changeイベントにXHRの機能を追加するほうが、操作の結果が即座に反映されて良いと思われるのではないでしょうか。</p><pre><code class=" language-javascript"><span class="token keyword">var</span> sortForm <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">&#39;.sorter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sortForm<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>type <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">&#39;radio&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    this<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ラジオボタンにスタイルをつけてボタンのような見た目にし、読み込み中アイコンで明確なフィードバックを提供しているので、この方針でも問題ないように思えます。しかし、本章の冒頭でも触れた、<em>ユーザーに制御させる</em>という原則を忘れてはいけません。明確な送信アクションを取り除くと、XHRが走ることを予想できないユーザーが出てくる可能性があります。ユーザーはコントロールを奪われたように感じ、インターフェイスに対する信頼が損なわれるかもしれません。</p><p>加えて注意すべきは、キーボードユーザーがこのウィジェットを操作する場合、ラジオボタンのオプション間を移動するために矢印キーを使わなければならないという点です。矢印キーを押すと、隣接するラジオボタンがフォーカスされるだけでなく、<em>選択</em>もされます。つまり、オプションの端から端まで移動すると、それだけで<code>change</code>イベントが合計3回発火することになります。</p><p><code>change</code>イベントを<code>click</code>イベントに置き換えることで、フィルタオプションを選んだ際のXHRの動作を、マウスユーザーとタッチユーザーだけに限定することができます。</p><pre><code class=" language-javascript"><span class="token keyword">var</span> sortForm <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelector<span class="token punctuation">(</span><span class="token string">&#39;.sorter&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sortForm<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>type <span class="token operator">!</span><span class="token operator">==</span> <span class="token string">&#39;radio&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    this<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>しかしこの際、冗長になったsubmitボタンを隠してしまうと、クリックもタップもできないキーボードユーザーは困ることになるでしょう。<em>Enter</em>キーでこのフォームを送信できると気づいてくれることを信じるほかありません。また、一部のプラットフォーム（特にiOS）では、submitボタンが存在しないとフォームを送信できなくなるため、submitボタンをただ単に<em>取り除く</em>ことはできません。その場合、例の<code>.visually-hidden</code>クラスに加え、<code>tabindex=&quot;-1&quot;</code>を指定して、ボタンが存在しながらも、ユーザーによってフォーカスできない状態にする必要があります。</p><pre>&lt;button type=&quot;submit&quot; class=&quot;visually-hidden&quot; tabindex=&quot;-1&quot;>並べ替え&lt;/button></pre><p>これらの対策を行っても、ユーザーが実際にこうした挙動を理解するか、<em>好む</em>のかということは、ユーザーテストで確認すべき問題です。多様なユーザーにテストしてもらうことは、インクルーシブデザイン上の決定が適切かどうかを正確に評価する最も良い方法です。</p><blockquote><p>「ユーザーテストの人員を幅広く募集する中に、障害を持つ参加者を含めること。数は少なくても、さまざまな障害や支援技術を含めることを目指す。」―― Government Digital Services（イギリス）</p></blockquote><p>イギリス政府のマニュアルには、標準的なユーザーテストを補完するものとして、<a href="https://www.gov.uk/service-manual/user-centred-design/user-research/accessibility-testing.html"><span class="link">アクセシビリティテスト</span></a><sup><a href="#fn23_12"><span class="sup_link">（脚注167）</span></a></sup>のセクションが設けられています。予算が少なく、時間が限られている場合は、メインのテストの一部にさまざまな特性のユーザーを含めてしまいましょう。</p><h2>検索結果をもっと読み込む</h2><p>扱っている商品数が多い場合、検索語句やフィルタオプションによっては、かなりの数のアイテムと一致する可能性があります。一度ですべて取得して表示すると、パフォーマンス上の深刻なボトルネックの原因になると同時に、泣く子も黙るような恐ろしく長いページになることがあります。検索結果を読み込む量は少なめにしておき、ユーザーが必要としたときに追加で取得するほうがはるかに優れています。これを行う方法はいくつか考えられます。そのうちのひとつ――無限スクロール――には、インクルーシビティに関する重大な問題があります。</p><h3>無限スクロール</h3><p>この<a href="https://www.smashingmagazine.com/2013/05/infinite-scrolling-lets-get-to-the-bottom-of-this/"><span class="link">無限スクロール</span></a><sup><a href="#fn23_13"><span class="sup_link">（脚注168）</span></a></sup>というパターンは、現在のコンテンツの終わりに達した時点で、ユーザーによるスクロールの操作を、コンテンツの自動読み込みという動作に結びつけるものです。その狙いは、ユーザーに対して特別なアクションを求めることなく、コンテンツをストリームとして提供することです。ただし、きわめて慎重に実装されている場合を除き、無限スクロールは、さまざまな操作方法に対してストレスに満ちた体験をもたらす結果になりがちです。</p><p>たとえば、私はマウスを使っていますが、スクロールバーのハンドルをドラッグしてページをスクロールすることもあります。新しい検索結果が読み込まれると、コンテンツの量が増えたことに伴い、ハンドルが上のほうに移動します。ハンドルがマウスカーソルの場所から移動したことに気づかずに、再度ドラッグしようとして、スクロールバーのトラック部分をクリックしてしまうことがあります。すると、ページが現在位置から急に下に飛ぶことになります。これは非常に直観に反する不快な体験ですし、まだ見ていないコンテンツを見逃してしまうこともあります。</p><p><a href="http://simplyaccessible.com/article/infinite-scrolling/"><span class="link">デレク・フェザーストン（Derek Featherstone）が書いている</span></a><sup><a href="#fn23_14"><span class="sup_link">（脚注169）</span></a></sup>ように、無限スクロールはキーボードユーザーにとってもストレスがたまる体験です。ストリームの中の項目にインタラクティブな要素（「今すぐ購入」ボタンなど）があると、フォーカス可能な要素がストリームに無限に追加されていきます。その結果、Tabキーでメインコンテンツを通り越すことが不可能になり、下のフッター内のインタラクティブな要素に移動することができなくなります。</p><p>デレクは2つの解決策を提示しています。彼はそのひとつをとても気に入っていて、2回も記載しています。</p><p class="list"><span class="digit">1. 無限スクロールは実装しないでください。</p><p class="list"><span class="digit">2. 自動の無限スクロールを、ユーザーが明示的に操作する「検索結果をもっと読み込む……」というボタンやリンクに置き換えましょう。ユーザーが何度か読み込みを繰り返したら、自動読み込みをオンにするかを尋ねるプロンプトを表示します。</p><p class="list last-item"><span class="digit">3. いや、本当に、とにかく無限スクロールは実装しないでください。</p><h3>「もっと読み込む」ボタン</h3><p>「もっと読み込む」ボタン――それは<code>&lt;button></code>である<em>べき</em>です――は、現在表示されている検索結果の最後に置かれ、クリックすると、次の検索結果を読み込むためにXHRが送信されます。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 最後から2番目の項目 --></span>
    &lt;li>
    &lt;li>
        <span class="token comment">&lt;!-- 最後の項目 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-load-more</span><span class="token punctuation">></span></span>もっと読み込む<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre><p>新しいコンテンツが表示されたら、<code>data-load-more</code>ボタンにあるキーボードフォーカスを、新たに読み込まれた項目の先頭へと移動しましょう。そうしないと、ユーザーが見ているビューポートは変化せずに、フォーカスが当たっている<code>data-load-more</code>ボタンが画面外に押し出され、フォーカスを見失ってしまいます。</p><p>ほとんどのブラウザの実装では、ボタンからフォーカスが外れた<em>だけ</em>では、別のどこかにフォーカスが移るわけではないことに注意してください。するとブラウザは「<em>フリークアウトモード</em>」とも呼ばれる状態となり、何をフォーカスしていいかわからず、デフォルトでドキュメント本体にフォーカスが当たることになります。その結果、キーボード（スクリーンリーダーも含む）のユーザーは、ページコンテンツの先頭に飛ばされることになります。</p><p>ここでの有効な対処方法は、新たに表示された商品の最初のタイトル（<code>&lt;h3></code>）にフォーカスを移すことです。こうすると、その商品がビューポートの一番上に来ます（これはあらゆるタイプの目が見えているユーザーに役立ちます）。また、スクリーンリーダーでは、新しいコンテンツの最初の商品名である<code>&lt;h3></code>テキストが読み上げられます。</p><p>JavaScriptの<code>focus()</code>メソッドでフォーカスできるようにするには、最初の商品の<code>&lt;h3></code>に<code>tabindex=&quot;-1&quot;</code>を適用する必要がある点に注意してください。<code>tabindex=&quot;0&quot;</code>とは違い、この指定を行った要素は、ユーザーが直接フォーカスすることはできません。このケースでは、<code>&lt;h3></code>はアクションの対象になる（インタラクティブな）要素ではないので、ユーザーがフォーカスすることは望ましくありません。<code>&lt;h3></code>にフォーカスを移すのは、ユーザーを適切なコンテキストに導き、読み上げをはじめさせるときだけです。そこから<em>Tab</em>キーを押すとアーティストのリンクに移動し、もう一回押すと「今すぐ購入」リンクに移動します。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;-1&quot;</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- タイトルをフォーカス可能にする --></span>
        ガソリンスタンドにたたずむ裸の男
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/artist/kenny-mulbarton&quot;</span><span class="token punctuation">></span></span>by <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cite</span><span class="token punctuation">></span></span>ケニー・マルバートン<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cite</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/images/naked-forecourt-man.jpg&quot;</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;裸の男性が何食わぬ顔で給油ポンプにもたれかかっている、ハイコントラストの白黒写真。&quot;</span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dl</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>サイズ:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>30cm × 90cm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>価格:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span>35.95ユーロ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dt</span><span class="token punctuation">></span></span>評価:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dt</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dd</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/images/rating_4_5.svg&quot;</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;&quot;</span><span class="token punctuation">></span></span>5つ星のうち 4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dd</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dl</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/product/naked-man-in-garage&quot;</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;call-to-action&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;visually-hidden&quot;</span><span class="token punctuation">></span></span>ガソリンスタンドにたたずむ裸の男を<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>今すぐ購入
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- 新たに表示された商品の2番目 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- etc --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></code></pre><p>フィルタオプションを選択する場合と同様、XHRで処理されることになります。そのため、やはり同様に、読み込み中アイコンとライブリージョンを提供するべきです。このケースでは、「もっと読み込む」ボタンのテキストノードを読み込み中アイコンで置き換えることもできます。その場合、以下のような順で動作することになるでしょう。</p><p class="list"><span class="digit">1. </span>ユーザーが「もっと読み込む」ボタンをクリックする。</p><p class="list"><span class="digit">2. </span>ボタンのテキストが「読み込み中」に代わり、クリックを受け付けないように設定される。クリックされた際、読み込み中の状態であることを検出したら（たとえば、ボタンの<code>textContent</code>に「読み込み中」が含まれていたら）、何もせずに<code>return</code>する。</p><p class="list"><span class="digit">3. </span>目には見えないライブリージョンが「追加の商品リストを読み込み中」と読み上げる。</p><p class="list"><span class="digit">4. </span>XHRが処理される。</p><p class="list"><span class="digit">5. </span>成功すると、コンテンツが表示される。</p><p class="list"><span class="digit">6</span>ライブリージョンが「商品リストが読み込まれました」と読み上げる。</p><p class="list"><span class="digit">7. </span>ボタンから、新たに読み込まれた商品の最初の項目にフォーカスが移動する。ここで、5章「ナビゲーション領域」で説明したようなスムーズスクロールアクションを使うこともできる。</p><p class="list last-item"><span class="digit">8. </span>「もっと読み込む」ボタンの中身が元のテキストノードに戻り、<code>clickイベント</code>も再度処理されるようになる。</p><p>「もっと読み込む」ボタンの初期状態（左）と押された後の状態（右）。</p><p>無限スクロールは、ユーザーのスクロールアクションを乗っ取り、予期せぬ動作をします。ユーザーのコントロールは奪われ、ユーザー体験が損なわれます。「もっと読み込む」ボタンは、明示的な、ラベルがつけられたアクションを提供し、ユーザーの都合のよいときに実行できるようにします。これは、ヘニー・スワンの原則の2番目の項目である<strong>ユーザーに制御させる</strong>にも合致しています。</p><h2>表示オプション</h2><p>一般的に、デザイナーは、ユーザーのニーズを見越し、彼らのために賢明な判断を下すことが自分の仕事だと考えています。それがデザインというものではないでしょうか？おそらくそのとおりです。しかし、私たちは次のような問題にも取り組まなければなりません。</p><p class="list"><span class="bullet">•</span>ユーザーの設定はさまざまに異なっている。</p><p class="list last-item"><span class="bullet">•</span>ユーザーはさまざまな状況に居合わせている。</p><p>ユーザーのための判断の例として、<code>&lt;meta></code>タグのviewportに<code>user-scalable=no</code>を指定してズームを無効にするというものがあります。ユーザーに最適な文字サイズや表示倍率を決めて、それをユーザー自身が調節できないようにするこの指定は、まさにユーザーの<em>ために</em>判断されたものです。ユーザーが多様なのは必然であることを考えると、厚かましく無謀な行いです。</p><p>もちろん、デザイナーが個別に判断しなければならないこともあります。デザインのすべての部分が、ユーザーリサーチで直接裏づけられるわけではないからです。しかしその場合も、以下に従えば、判断に対する自信を高めることができます。</p><p class="list"><span class="bullet">•</span><strong>慣習</strong>：広く採用されているパターン、モチーフ、言葉を使う。</p><p class="list last-item"><span class="bullet">•</span><strong>選択</strong>：どのように利用するか、ユーザーが決められるようにする。</p><p>このフィルタウィジェットのパターンの仕上げとして、フィルターが適用されたコンテンツの表示方法をユーザーが選択できるようにします。</p><h3>リストか、グリッドか？</h3><p>このフィルタリングインターフェイスに対する最後の拡張として、検索結果の表示方法をリスト形式とグリッド形式のどちらにするか、ユーザーが選べるようにしましょう。そうすれば、ユーザーは自分に合った認識しやすいレイアウトを選択できます。リスト形式はシンプルですが、どうしても縦に長くなります。グリッドはリストよりも全体を見渡すことができますが、多くの情報が圧縮されていっぺんにビューポートに詰め込まれます。</p><p>調整を加えたフィルタウィジェットは、たとえば以下のような見た目になるでしょう。</p><p><img src="images/filter2.png" alt="フィルターのフォームに、リスト形式とグリッド形式を選択させる表示オプションの行が新たに出現している。" /><br /><em>submitボタンは「適用する」としています。並び替えと表示設定の両方に当てはまる、より広範囲なアクションです。</p><p>拡張したマークアップは以下の通りです。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;form&quot;</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sorter&quot;</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;get&quot;</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>並べ替え<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span> <span class="token attr-name">checked</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;most-recent&quot;</span><span class="token punctuation">></span></span>新着順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;popularity&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;popularity&quot;</span><span class="token punctuation">></span></span>人気順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-low-high&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-low-high&quot;</span><span class="token punctuation">></span></span>価格の安い順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;sort-method&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-high-low&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;price-high-low&quot;</span><span class="token punctuation">></span></span>価格の高い順<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>表示方法<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;list&quot;</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;#list-icon&quot;</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>use</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;visually-hidden&quot;</span><span class="token punctuation">></span></span>リスト<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;display-as&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;list&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;list&quot;</span> <span class="token attr-name">checked</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;grid&quot;</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;#grid-icon&quot;</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>use</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;visually-hidden&quot;</span><span class="token punctuation">></span></span>グリッド<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;radio&quot;</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;display-as&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;grid&quot;</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;grid&quot;</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;submit&quot;</span><span class="token punctuation">></span></span>適用する<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code></pre><h4>補足</h4><p class="list"><span class="bullet">•</span>主要なフィルタオブションと区別するため、「表示方法」の機能は独立した<code>&lt;fieldset></code>の中に入れています。</p><p class="list"><span class="bullet">•</span>リストとグリッドのアイコンにはインラインSVGを使用し、視覚的には非表示とした<code>&lt;text></code>要素を含めることで、各ラジオボタンにスクリーンリーダーでアクセスできるテキストラベルを提供しています。</p><p class="list"><span class="bullet">•</span>表示方法のラジオボタンにフォーカスすると、スクリーンリーダーでは、まず<code>&lt;legend></code>が読み上げられ、次に<code>&lt;label></code>とその他の情報が読み上げられます。したがって、リスト項目がフォーカスされる（そして選択される）と、「表示方法 グループ、リスト ラジオボタン、チェックされています、全2個中1個」などと読み上げられます。</p><p class="list last-item"><span class="bullet">•</span>submitボタンのラベルを「並べ替える」から「適用する」に変更し、並べ替えと表示設定の両方に<em>適用</em>しました。ダジャレになってしまったことをお許しください。</p><h3>自動的グリッド</h3><p>レイアウトがグリッドかリストかによらず、マークアップ上は常に商品をリスト（<code>&lt;ul></code>）として構成すべきです。実際にリストを<em>目で見ていない</em>ユーザーは、レイアウトに関係なくリストのセマンティクスによるメリットを得られます。また、クライアントサイドのDOM操作も少なくて済みます。変更すべきなのは親の<code>&lt;ul></code>のクラスだけです。レイアウトがシングルカラムの場合は<code>.list-display</code>、マルチカラムの場合は<code>.grid-display</code>とします。</p><p>「カラムはいくつが適切か？」という問いがあります。レスポンシブデザインの場合、スペースがどれだけあるかによって答えは変わります。一般に、カラム数はビューポートの幅に合わせます――ビューポートの幅が広いほどカラム数を増やせます。この場合、多くの手動のメディアクエリの記述が必要となり、レイアウト崩れの問題にも気を配る必要があります。</p><p>代わりにFlexboxを使えば、<code>flex-basis</code>を指定することで、要素ごとの理想的な幅を定義することができます。<code>flex-grow</code>と<code>flex-shrink</code>を有効にすることで、グリッドを構成する要素が、理想的な幅から伸びたり縮んだりするようになります。これにより、ビューポートの範囲が無限に広がったとしても、完全に規則的なグリッドを維持することができるのです。</p><pre><code class=" language-css"><span class="token selector">.grid-display </span><span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
    <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.grid-display li </span><span class="token punctuation">{</span>
    <span class="token property">flex-grow</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">flex-shrink</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span> <span class="token comment">/* 実際にはデフォルト値 */</span>
    <span class="token property">flex-basis</span><span class="token punctuation">:</span> 10em<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h4>補足</h4><p class="list"><span class="bullet">•</span><code>flex-basis</code>の値がカギになります。これは、Flexboxアルゴリズムにおいて、個々の項目が理想とする幅です。各項目は幅10emになろうとしつつ、しかし利用可能なスペースを余さずに分け合うべく<em>伸縮（flex）</em>するでしょう（後述の<code>flex-grow</code>と<code>flex-shrink</code>の解説を参照）。</p><p class="list"><span class="bullet">•</span><code>flex-basis</code>の値は、文字サイズに比例するようemで設定しています。つまり、カラムは文字サイズの変更に応じて幅が変わり、自動的にリフローされるということです。</p><p class="list"><span class="bullet">•</span><code>flex-grow</code>の<code>1</code>という値は、あまったスペースを埋めるために、項目の幅が10emを超えて伸びることを意味します。</p><p class="list"> <span class="bullet">•</span><code>flex-shrink</code>の<code>1</code>という値（実際はこの値がデフォルトなので省略可能）によって、必要なときには項目の幅が狭くなり、レイアウトが破綻しないようになっています。</p><p class="list last-item"><span class="bullet">•</span><code>flex-wrap</code>が有効になっているため、他の項目を並べた横に幅10em以上のスペースがなく、要素が収まらないときは、次の行に折り返して表示されます。</p><h4>適切なカラム幅の確保</h4><p>構築してきたのは、自動的に構成されるグリッドシステムです。ごく少ないコードで、<em>無限の</em>ビューポート範囲に対して、コンテンツを崩さずに表示できます。これは非常にインクルーシブなレイアウト方法です。</p><p>残った課題は、コンテンツの読みやすさを確保することです。3章「パラグラフ」の内容を覚えているでしょうか。そう、カラム幅を広くしすぎてはいけなかったはずです。いまのままでは、幅の広いビューポートで問題が起きる危険があります。特に、折り返しアルゴリズムによって、最後の行に最後の項目1つだけが配置された場合です。</p><p><img src="images/grid_with_long_item.png" alt="5カラムのグリッドに11の項目が表示されている。つまり、最後の項目はそれひとつで行全体を占めている。" /></p><p>以下のコードは、項目の<code>max-width</code>を20emに制限するように調整したものです。シンメトリーのため、センターライン上にコンテンツをまとめるのが私の好みです。そのため、flexコンテナで<code>justify-content: center;</code>と宣言しています。</p><pre><code class=" language-css"><span class="token selector">.grid-display </span><span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
    <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.grid-display li </span><span class="token punctuation">{</span>
    <span class="token property">flex-grow</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">flex-basis</span><span class="token punctuation">:</span> 10em<span class="token punctuation">;</span>
    <span class="token property">max-width</span><span class="token punctuation">:</span> 20em<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><img src="images/grids_with_max_widths.png" alt="これでグリッドの項目が縦のセンターライン上にまとまり、20em以上の幅にはなりません。" /></p><p>Flexboxのアルゴリズムは、うまく使えば非常にパワフルになります。実際に使うときには、この例で10emや20emとした値をコンテンツに合わせて調節する必要があるでしょう。</p><p>（<strong>注：</strong>IE10とIE11にはいやらしいバグがあり、flexコンテナをフォーカス可能にしたとき、子要素のほうにフォーカスが当たってしまう場合があります。<a href="http://allyjs.io/api/fix/pointer-focus-children.html"><span class="link">便利なa11y.jsライブラリで、このバグを修正できます</span></a><sup><a href="#fn23_15"><span class="sup_link">（脚注170）</span></a></sup>）</p><h4>右から左へのグリッド</h4><p>2章「ドキュメント全体」で確認したとおり、Webページの言語を宣言することで、支援技術と翻訳ツールを最大限に活用できるようになります。海外のユーザーにも対応することは、インクルージョンにとって大きな一歩です。英語は左から右に読みますが、アラビア語など、右から左に読む言語もあります。ドキュメントのテキスト方向は、HTML要素に（<code>lang</code>属性とともに）<code>dir</code>属性を含めることで設定できます。</p><pre>&lt;html lang=&quot;ar&quot; dir=&quot;rtl&quot;></pre><p>floatによるCSSレイアウトは、この設定の影響を受けません。つまり、floatしたコンテンツのレイアウトは、手動で逆転させなければなりません。</p><pre><code class=" language-css"><span class="token selector">.content </span><span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 60%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[dir=&quot;rtl&quot;] .content </span><span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.sidebar </span><span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 40%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[dir=&quot;rtl&quot;] .sidebar </span><span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>Flexboxは、すばらしいことに、方向を自動的に処理してくれます。<code>dir</code>が<code>rtl</code>に設定されたドキュメント内のすべてのflexコンテナは、各行のコンテンツを期待通りに右から左に表示します。<code>flex-direction</code>プロパティの値を<code>row</code>から<code>row-reverse</code>にすることで、方向を切り替えることもできます。</p><p>ドキュメントが右から左の方向設定にもかかわらず、グリッドを左から右の設定で配置したい場合は、flexコンテナに対してCSSのdirectionプロパティを指定することで強制的に左寄せにできます。</p><pre><code class=" language-css"><span class="token selector">.grid-display </span><span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">direction</span><span class="token punctuation">:</span> ltr<span class="token punctuation">;</span>
    <span class="token comment">/* このltr指定はrow-reverseのように動作する */</span>
    <span class="token property">flex-direction</span><span class="token punctuation">:</span> row<span class="token punctuation">;</span>
    <span class="token property">flex-wrap</span><span class="token punctuation">:</span> wrap<span class="token punctuation">;</span>
    <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>（<strong>注：</strong>この自動的な方向の逆転は<code>&lt;table></code>要素にも当てはまり、カラムの順序が入れ替わります。ですが、<code>&lt;table></code>要素をレイアウトには使用しません。支援技術に誤ったセマンティクスを提供することになるからです。）</p><h2>動的なコンテンツへの柔軟な対応</h2><p>ここまでずっと、コンテンツのために構造をデザインしてきました。ここでも同様に、コンテンツに注目していくべきです。言葉遣いやトーンについては3章「パラグラフ」で説明したので、ここではコンテンツの長さの変動について考えてみましょう。</p><p>インターフェイスコンポーネントの静的モックアップが廃れた主な理由のひとつに、それが理想的なコンテンツを表しがちだから、という点があります。例えば、特定の長さの人名、すべてがぴったり5行に収まる説明文などです。そしてフロントエンドが実装されたとき、変動するコンテンツがレイアウトに予期せぬ影響を与えて問題が発生します。</p><p>プロトタイプの段階で、商品グリッドインターフェイスがコンテンツの長さの変動を許容できるかを確認するためには、<a href="https://github.com/Heydon/forceFeed"><span class="link">forceFeed.js</span></a><sup><a href="#fn23_16"><span class="sup_link">（脚注171）</span></a></sup>などのツールを使うとよいでしょう。このスクリプトを使うと、指定したパラメータに沿ってランダムに生成されたコンテンツの配列が、レイアウト案の中に流し込まれます。</p><p>たとえば、インターフェイスがさまざまな長さの名前を許容できるかテストするには、以下のように、写真家リンクの<code>&lt;cite></code>にforceFeed.jsの<code>data-forcefeed</code>属性を追加します。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/artist/kenny-mulbarton&quot;</span><span class="token punctuation">></span></span>by <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cite</span> <span class="token attr-name">data-forcefeed</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;words|2&quot;</span><span class="token punctuation">></span></span>ケニー・マルバートン<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cite</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code></pre><p>パラメータの<code>words</code>は、さまざまな長さの単語の配列を参照します。パラメータの<code>2</code>は、含めたいランダムな単語の数を表します。ほとんどの人名は2つの単語――苗字と名前――で構成されているので、2が妥当でしょう。これをページ内のすべての写真家の<code>&lt;cite></code>に対して実行するには、まずforceFeed.jsを読み込んでから、以下のスクリプトを書きます。ちなみに、ここでは説明を簡略にするために<em>lorem ipsum</em>の短いセットを使っていますが、自分の好きな単語を入れてもかまいません。</p><pre><code class=" language-javascript">window<span class="token punctuation">.</span>words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;lorem&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ipsum&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;dolor&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;amet&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;adipsing&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;consectetur&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;elit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sed&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;commodo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;ligula&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;vitae&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mollis&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pellentesque&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;condimentum&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sollicitudin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;fermentum&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;enim&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tincidunt&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> cites <span class="token operator">=</span> document<span class="token punctuation">.</span>querySelectorAll<span class="token punctuation">(</span><span class="token string">&#39;cite&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>forEach<span class="token punctuation">.</span>call<span class="token punctuation">(</span>cites<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cite<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cite<span class="token punctuation">.</span>addAttribute<span class="token punctuation">(</span><span class="token string">&#39;data-forcefeed&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;words|2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

forceFeed<span class="token punctuation">(</span><span class="token punctuation">{</span>words<span class="token punctuation">:</span> window<span class="token punctuation">.</span>words<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>これらの単語の組み合わせによる許容度のテストは単純です。ページを何度もリロードし、ランダムな組み合わせの単語が、たとえば見苦しい折り返しなどによってレイアウトを破綻させていないかを確認します。</p><h3>商品タイトル</h3><p>forceFeed.jsにはもうひとつの特徴があります。このスクリプトでは、追加する項目の数について、<em>x</em>から<em>n</em>の<em>あいだ</em>、という指定ができます。これは、写真プリントのタイトルを動的なコンテンツとしてテストするのに役立ちます。forceFeed.jsを機能させるには、データを流し込む箇所をくくる要素が必要なことに注意してください。ここではスクリプトを使って、リンクの前にあるタイトルを&lt;span>で囲んだとしましょう。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;-1&quot;</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- タイトルをフォーカス可能にする --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">data-forcefeed</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;words|1|10&quot;</span><span class="token punctuation">></span></span>ガソリンスタンドにたたずむ裸の男<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;/artist/kenny-mulbarton&quot;</span><span class="token punctuation">></span></span>by <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cite</span> <span class="token attr-name">data-forcefeed</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;words|1&quot;</span><span class="token punctuation">></span></span>ケニー・マルバートン<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cite</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span></code></pre><p><code>words|1|10</code>のように2つの数字を指定すると、スクリプトはひとつめの数字からふたつめの数字の<em>あいだ</em>の数の配列項目をテキストノードとして配置します。単語数1～10という変動幅は、商品タイトルに予想される言葉としては妥当でしょう。後はページを再読み込みしながら、視覚的なレイアウトの破綻が起きにくくなるように、グリッドに調整を加えていきます。よくある問題は、項目間の高さに違いが出ることによって折り返しが発生する、コンテンツが折り返さずに枠からはみ出してしまう、といったものです。</p><h2>まとめ</h2><p>このパターンでは、2つのことがわかったのではないでしょうか。ひとつめは、HTMLで既に提供されているふまいを、必要もないのに、安易にJavaScriptで作り直していることがよくあるということ。ふたつめは、まずセマンティックなHTMLを使用して、CSSをプログレッシブエンハンスメントとして使うやり方があるということ。加えて、コンテンツの表示方法にをユーザーが<em>選択</em>し、<em>制御</em>できるようにすることの重要性について検討しました。また、動的に変動するコンテンツに対応できるデザインであることを確認するための、いくつかのテクニックを紹介しました。本書全体を通して説明してきたように、インクルーシブデザインは、どんなコンテンツが与えられても融通が利くビジュアルデザインである、ということも意味するのです。</p><h3>避けるべきこと</h3><p class="list"><span class="bullet">•</span>HTMLがすでに提供しているふるまいをJavaScriptで作る。</p><p class="list"><span class="bullet">•</span>右から左に読む言語をサポートできないグリッドシステム。</p><p class="list"><span class="bullet">•</span>無限スクロール。</p><p class="list last-item"><span class="bullet">•</span>理想的なコンテンツを使ったプロトタイピング。</p><div class="fn_overview"><p class="separator">—</p><p id="fn23_1"><span class="fn_number">1.</span><a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="fn_link">http://heydonworks.com/practical_aria_examples/#tab-interface</span></a></p><p id="fn23_2"><span class="fn_number">2.</span><a href="https://www.w3.org/TR/aria-in-html/#first-rule-of-aria-use"><span class="fn_link">https://www.w3.org/TR/aria-in-html/#first-rule-of-aria-use</span></a></p><p id="fn23_3"><span class="fn_number">3.</span><a href="http://www.heydonworks.com/article/reinventing-the-hyperlink"><span class="fn_link">http://www.heydonworks.com/article/reinventing-the-hyperlink</span></a></p><p id="fn23_4"><span class="fn_number">4.</span><a href="http://www.sitepoint.com/replacing-radio-buttons-without-replacing-radio-buttons/"><span class="fn_link">http://www.sitepoint.com/replacing-radio-buttons-without-replacing-radio-buttons/</span></a></p><p id="fn23_5"><span class="fn_number">5.</span><a href="http://wtfforms.com/"><span class="fn_link">http://wtfforms.com/</span></a></p><p id="fn23_6"><span class="fn_number">6.</span><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><span class="fn_link">https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest</span></a></p><p id="fn23_7"><span class="fn_number">7.</span><a href="http://w3c.github.io/aria/practices/aria-practices.html#LiveRegions"><span class="fn_link">http://w3c.github.io/aria/practices/aria-practices.html#LiveRegions</span></a></p><p id="fn23_8"><span class="fn_number">8.</span><a href="http://w3c.github.io/aria/aria/aria.html#aria-live"><span class="fn_link">http://w3c.github.io/aria/aria/aria.html#aria-live</span></a></p><p id="fn23_9"><span class="fn_number">9.</span><a href="http://w3c.github.io/aria/aria/aria.html#status"><span class="fn_link">http://w3c.github.io/aria/aria/aria.html#status</span></a></p><p id="fn23_10"><span class="fn_number">10.</span><a href="http://snook.ca/archives/html_and_css/hiding-content-for-accessibility"><span class="fn_link">http://snook.ca/archives/html_and_css/hiding-content-for-accessibility</span></a></p><p id="fn23_11"><span class="fn_number">11.</span><a href="https://dequeuniversity.com/library/aria/content-feedback/liveregion-playground"><span class="fn_link">https://dequeuniversity.com/library/aria/content-feedback/liveregion-playground</span></a></p><p id="fn23_12"><span class="fn_number">12.</span><a href="https://www.gov.uk/service-manual/user-centred-design/user-research/accessibility-testing.html"><span class="fn_link">https://www.gov.uk/service-manual/user-centred-design/user-research/accessibility-testing.html</span></a></p><p id="fn23_13"><span class="fn_number">13.</span><a href="https://www.smashingmagazine.com/2013/05/infinite-scrolling-lets-get-to-the-bottom-of-this/"><span class="fn_link">https://www.smashingmagazine.com/2013/05/infinite-scrolling-lets-get-to-the-bottom-of-this/</span></a></p><p id="fn23_14"><span class="fn_number">14.</span><a href="http://simplyaccessible.com/article/infinite-scrolling/"><span class="fn_link">http://simplyaccessible.com/article/infinite-scrolling/</span></a></p><p id="fn23_15"><span class="fn_number">15.</span><a href="http://allyjs.io/api/fix/pointer-focus-children.html"><span class="fn_link">http://allyjs.io/api/fix/pointer-focus-children.html</span></a></p><p id="fn23_16"><span class="fn_number">16.</span><a href="https://github.com/Heydon/forceFeed"><span class="fn_link">https://github.com/Heydon/forceFeed</span></a></p></div></div></body></html>
