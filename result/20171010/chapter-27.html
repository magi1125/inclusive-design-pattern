<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
PUBLIC "-//W3C//DTD XHTML 1.1//EN"
       "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"><html xml:lang="ja" xmlns="http://www.w3.org/1999/xhtml"><head><title>テスト駆動マークアップ | インクルーシブHTML+CSS &amp; JavaScript</title><link rel="stylesheet" href="css/book.css" type="text/css"/><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><meta name="EPB-UUID" content="24CC751A-5435-483D-851C-00DC23A33E17"/></head><body><div class="body"><h1>テスト駆動マークアップ</h1><p><a href="https://en.wikipedia.org/wiki/Test-driven_development"><span class="link">テスト駆動開発（TDD）</span></a><sup><a href="#fn27_1"><span class="sup_link">（脚注193）</span></a></sup>では、コードの信頼性を担保しながら開発を進めるために、開発者は頻繁にイテレーションを行うことができます。まずテストを書いて期待される結果を定義してから、それを満たすように機能を作ることで、ビルドに成功したものが想定通り確実に動作することを保証できます。「いったいぜんたい何が起きているんだ？」というスリルを求める人は、TDDを少し退屈に感じるかもしれませんが、これが堅実なアプローチなのです。</p><p>アプリケーション開発では通常、関数に対してテストを書き、それらの関数が予期したとおりの結果を返しているかどうかを確認します。たとえば、自作の<code>add.js</code>というNode.jsモジュールで<em>add()</em>関数が正しく動作するかテストしたい場合は、<a href="https://mochajs.org"><span class="link">Mocha</span></a><sup><a href="#fn27_2"><span class="sup_link">（脚注194）</span></a></sup>と、アサーションライブラリ<a href="http://chaijs.com/"><span class="link">Chai</span></a><sup><a href="#fn27_3"><span class="sup_link">（脚注195）</span></a></sup>を使って以下のようにできます。</p><pre><code class=" language-javascript"><span class="token keyword">var</span> expect <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;chai&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span>
<span class="token keyword">var</span> add <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;../lib/add.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

describe<span class="token punctuation">(</span><span class="token string">&#39;Add module&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    describe<span class="token punctuation">(</span><span class="token string">&#39;The add() function&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        it<span class="token punctuation">(</span><span class="token string">&#39;3に1を加えた際、4になるべき&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>equal<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>あとは<code>npm test</code>（または何らか設定したエイリアス）を実行すれば、この関数が期待通りに動いてくれるかがわかるでしょう。</p><p>実に結構なことではありますが、しかし、これはほとんどが命令型言語であるJavaScriptのために設計されています。では、HTMLのような宣言型言語向けに同様のテストを書けたとしたらどうでしょう？そうであれば、同様にテストを書くことで<em>マークアップの構造</em>の正しさを保証できます。きちんと構成されたマークアップはWebアクセシビリティに大いに寄与するため、TDDの手法をマークアップに適用できれば、インクルーシブでないパターンが作られることを防ぐことができます。</p><p>実は、このタスクにぴったりの言語があることがすでにわかっています。都合の良いことに、それ自体が宣言型言語であり、さらに幸いなことに、付加的なライブラリに依存することもありません。言うまでもなく、CSSのことです。</p><h2>セレクタのロジック</h2><p>CSSは宣言型言語ですが、セレクタの構造の中にはロジックが存在しています。セレクタは、HTMLの構造にマッチさせるために使われる、条件ベースの式です。CSSセレクタはこの用途に非常に適しており、<a href="http://emmet.io/"><span class="link">Emmet</span></a><sup><a href="#fn27_4"><span class="sup_link">（脚注196）</span></a></sup>などのマークアップを<em>書く</em>ためのツールも、セレクタに似た構文を採用しています。CSSセレクタがロジックを内包していることは、JavaScriptの構文でセレクタの処理を再現しようとしてみるとよくわかります。たとえば、無効になっていないすべてのボタンにマッチさせたい場合は、以下のように記述します。</p><pre><code class=" language-css"><span class="token selector">button:not(:disabled) </span><span class="token punctuation">{</span> … <span class="token punctuation">}</span></code></pre><p>これをJavaScriptで書き直すと、以下のようになります。</p><pre><code class=" language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>nodeName <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&#39;button&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>element<span class="token punctuation">.</span>disabled<span class="token punctuation">)</span> <span class="token punctuation">{</span> … <span class="token punctuation">}</span></code></pre><p>通常、CSSセレクタは期待されるパターンにマッチさせるのに使いますが、破綻した、不正なパターンを対象にすることもできます。そうしたパターンが存在する場合、エラースタイルを適用して問題をハイライトすることができます。</p><pre><code class=" language-css"><span class="token selector">[undesired pattern] </span><span class="token punctuation">{</span>
    <span class="token comment">/* エラースタイルなど
    outline: 0.5em solid red;
    */</span>
<span class="token punctuation">}</span></code></pre><p>あとは、ハイライトされた要素を調べた際に、その問題点の説明が伝わるようにすればよいのです。タブインターフェイスのパターンを題材として、どのような動作になるのかを確認してみましょう。</p><h2>テスト駆動のタブインターフェイス</h2><p>ARIAで強化されたアクセシブルなタブインターフェイスについては、私の著書<a href="https://shop.smashingmagazine.com/products/apps-for-all"><span class="link">『Apps For All: Coding Accessible Web Applications』</span></a><sup><a href="#fn27_5"><span class="sup_link">（脚注197）</span></a></sup>（日本語版：『コーディングWebアクセシビリティ - WAI-ARIAで実現するマルチデバイス環境のWebアプリケーション』ボーンデジタル刊）で詳しく説明しています。また、<a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="link">解説つきのデモ</span></a><sup><a href="#fn27_6"><span class="sup_link">（脚注198）</span></a></sup>も利用できます。このようにまとめられたパターンや、想定される動作についてあまりご存じない方は、上記のどちらかの資料を参照してください。</p><p>以下に示すコード例は、タブインターフェイスの初期状態をマークアップしたものです。このタブインターフェイス内の要素に対して、プロパティとリレーションシップを検証するテストを書き、想定通りに構成されているか確認しましょう。タブインターフェイスのように比較的複雑なパターンの場合、構造の一部をうっかり間違えたり、抜かしたり、不適切な形にしてしまいやすいものです。テストを書くことは、そうした問題を防ぐ良い機会になります。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab-interface&quot;</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tablist&quot;</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;presentation&quot;</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;#panel1&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab1&quot;</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab&quot;</span> <span class="token attr-name">aria-selected</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;true&quot;</span><span class="token punctuation">></span></span>1番めのタブ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;presentation&quot;</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;#panel2&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab2&quot;</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab&quot;</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;-1&quot;</span><span class="token punctuation">></span></span>2番めのタブ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;presentation&quot;</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;#panel3&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab3&quot;</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab&quot;</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;-1&quot;</span><span class="token punctuation">></span></span>3番めのタブ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tabpanel&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;panel1&quot;</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab1&quot;</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- タブパネル1のコンテンツ--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tabpanel&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;panel2&quot;</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab2&quot;</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- タブパネル2のコンテンツ --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tabpanel&quot;</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;panel3&quot;</span> <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span>&quot;tab3&quot;</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- タブパネル3のコンテンツ--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre><h3>テストの内容</h3><p>それでは上から見ていきましょう。これらのタブは、各タブをグループ化するための<code>tablist</code>ロールを持つ要素内にあるときのみ、支援技術で正しく機能することがわかっています。以下のセレクタは、<code>class=&quot;tab-interface&quot;</code>コンテナ内の<code>&lt;ul></code>要素を見つけて、<code>role=&quot;tablist&quot;</code>属性がない場合はそれをハイライト表示します。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>これで、適切に配置された<code>tablist</code>セマンティクスが存在しない場合、リスト要素に見苦しい赤枠が出現するようになります。</p><p><a href="https://www.w3.org/TR/wai-aria/roles#tablist"><span class="link"><code>tablist</code>ロールの仕様</span></a><sup><a href="#fn27_7"><span class="sup_link">（脚注199）</span></a></sup>で定められているように、tablist内には、<code>role=&quot;tab&quot;</code>の形で明示的に<code>tab</code>ロールを持つ「所有要素」が必要です。この属性を各<code>&lt;li></code>要素に直接指定する実装方法もありますが、<code>&lt;a></code>要素を使用するのが私の好みです。そうすれば、この構造をリンクリストの形にデグレードすることも容易だからです。リンクリストとナビゲーションの詳細については、6章「ナビゲーション領域」を参照してください。</p><p><code>&lt;a></code>要素には<code>tab</code>ロールを指定すると決めたので、それに対応するテストを書き加えましょう。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>JavaScriptでタブインターフェイスのセマンティクスを加えると、リストのセマンティクスが余計になるため、各<code>&lt;li></code>要素に<code>role=&quot;presentation&quot;</code>を指定して、リストのセマンティクスを消します。前のテストと同じロジックの後ろに、このテストのセレクタを書き足しましょう。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>タブインターフェイスの適切なふるまいとしては、常にタブがひとつだけ選択され、そのことが<a href="http://w3c.github.io/aria/aria/aria.html#aria-selected"><span class="link"><code>aria-selected</code></span></a><sup><a href="#fn27_8"><span class="sup_link">（脚注200）</span></a></sup>によってアクセシブルに明示されている必要があります。この選択されているタブだけを、ユーザーが<em>Tab</em>キーでフォーカスできるようにします。その他のタブにはすべて<code>tabindex=&quot;-1&quot;</code>属性を指定し、矢印キーでのみ選択可能にするべきです。これを確認するには、さらにふたつのテストセレクタが必要です。ふたつめのセレクタは、ひとつめのセレクタを反転したものになります。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]),
[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;],
[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>tabpanel</code>の<code>aria-labelledby</code>属性値が誤っているパターンを見つけることさえできます。以下の例ではテストセレクタを追加し、適切なロールが設定されたタブパネルに「tab」で始まる<code>aria-labelledby</code>属性がない場合にマッチさせています。属性セレクタ内で、<em>～で始まる</em>、を意味する<code>^</code>修飾子を使って<code>[aria-labelledby^=&quot;tab&quot;]</code>のように書くと、このようなファジーなマッチングが可能になります。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]),
[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;],
[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;]),
[role=&quot;tabpanel&quot;]:not([aria-labelledby^=&quot;tab&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>もちろん、<code>aria-labelledby</code>そのものが存在しないケースも、このセレクタで検知します。</p><p>最後に、すべてのタブパネルに<code>tabpanel</code>ロールが指定されていることを確かめましょう。ここでは、タブパネル群はリストの後に出現することになっています。このテストでは<a href="https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors"><span class="link">間接セレクタ</span></a><sup><a href="#fn27_9"><span class="sup_link">（脚注200）</span></a></sup>の<code>~</code>を使って、<code>tablist</code>の後ろに<code>tabpanel</code><em>ではない</em><code>&lt;div></code>があるかどうかを調べます。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]),
[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;],
[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;]),
[role=&quot;tabpanel&quot;]:not([aria-labelledby^=&quot;tab&quot;]),
[role=&quot;tablist&quot;] ~ div:not([role=&quot;tabpanel&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p><code>tablist</code>とタブパネル群のあいだにコンテンツがあると、インターフェイスがバラバラになって混乱を招きます。先のテストに加えて、<code>tabpanel</code>ロールを持つ<code>&lt;div></code>が、<code>tablist</code>の直後に続く兄弟要素になっていることを確かめます。このテストセレクタでは、<a href="https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors"><span class="link">隣接セレクタ</span></a><sup><a href="#fn27_10"><span class="sup_link">（脚注201）</span></a></sup>（または隣接兄弟セレクタ）の<code>+</code>を使います。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]),
[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;],
[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;]),[role=&quot;tabpanel&quot;]:not([aria-labelledby^=&quot;tab&quot;]),
[role=&quot;tablist&quot;] ~ div:not([role=&quot;tabpanel&quot;]),
[role=&quot;tablist&quot;] + div:not([role=&quot;tabpanel&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3>エラーメッセージ</h3><p>これまでは、望ましくないパターンにマッチする要素に赤のアウトラインを表示してきました。しかし、エラーに関する説明がなければあまり役に立ちません。私が作った実験的なCSSテスト用ブックマークレットである<a href="http://heydonworks.com/revenge_css_bookmarklet/"><span class="link">revenge.css</span></a><sup><a href="#fn27_11"><span class="sup_link">（脚注202）</span></a></sup>では、アクセシビリティ関連のよくあるマークアップエラーをテストセレクタで特定し、疑似コンテンツを使ってエラーメッセージを提供していました。たとえば以下のセレクタでは、不適切な構成のリストに対して、大胆にメッセージを表示します。</p><pre><code class=" language-css"><span class="token selector">ol > *:not(li)::after,
ul > *:not(li)::after </span><span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;ul>または&lt;ol>の直接の子になれるのは&lt;li>だけです。&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>ただし、このエラーを画面に表示することには問題が伴います。このスタイルはサイト側のCSSと相互に影響するため、サイト側で疑似要素にスタイルをつけると、エラーのスタイルを上書きしてしまうことがあります。エラーメッセージの見た目や読みやすさを台無しにすることがないように、きわめて慎重にならなければなりません。連続する兄弟要素のエラー（前の例で検出している、<code>&lt;li></code>が誤って別のものに置き換わってしまった場合など）がある場合は、エラーを表示するスペースも問題になります。</p><p><a href="https://ffoodd.github.io/a11y.css/"><span class="link">A11y.css</span></a><sup><a href="#fn27_12"><span class="sup_link">（脚注203）</span></a></sup>――<a href="https://twitter.com/ffoodd_fr"><span class="link">ゲール・プパール（Gaël Poupard）</span></a><sup><a href="#fn27_13"><span class="sup_link">（脚注204）</span></a></sup>による、より高度なCSS製アクセシビリティテストツール――は、各pseudo-contentメッセージをドキュメント先頭に配置し、マウスカーソルを合わせると表示されるようにすることで、この問題を克服しています。</p><p>しかし、なぜわざわざエラーメッセージをすべてページ上に表示する必要があるのでしょうか？かわりに、開発者ツールのCSSインスペクタをJavaScriptコンソールのように使って、そこにエラーメッセージを提供することもできます。どの要素を調査すべきか開発者に示すため、赤いアウトラインは残します。</p><p>このケースでは、単に<code>display:none;</code>で疑似コンテンツのメッセージを隠せばよいでしょう。</p><p><img src="images/dev_tools_1.png" alt="開発ツールのCSS宣言ブロックのスクリーンショット。contentの宣言の上にdisplay:none;宣言が指定されている。" /><br /><em>開発者ツールのCSS宣言ブロックのスクリーンショット。content宣言の上に<code>display:none;</code>宣言が指定されています。</em></p><p>些細な問題がふたつほどあります。ひとつめの問題は、同じ要素に2つのエラーがある場合です。CSSインスペクタの中では、カスケードの最終結果以外のすべてがグレーアウト（打ち消し線がついたスタイルで表示）されてしまいます。これは、最後のエラー以外は当てはまらないかのような、誤解を招く見え方になります。ふたつめの問題は、<code>display:none;</code>はエラーメッセージのおまけにすぎない――すなわち、無用なノイズだという点です。</p><h4>ERRORプロパティ</h4><p>まずはっきりさせておきます！――CSSには<code>ERROR</code>プロパティなどというものはありませんし、追加される予定もありません。しかし、認識されないCSSプロパティを使ってCSSインスペクタにエラーログを残す方法には、いくつかのメリットあります。まず、冗長だった疑似コンテンツと<code>display:none;</code>プロパティの記述が不要になり、それぞれのCSSエラーの記述が以下のように短くなります。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> タブインターフェイスである<span class="token ignore">&lt;</span>ul<span class="token ignore">></span>にはtablist WAI-ARIAロールを指定しなければなりません。
<span class="token punctuation">}</span></code></pre><p>エラーをシングルクォーテーションで囲んで文字列としてカプセル化する必要がなくなっていることに注目してください。さらに、認識されないプロパティは詳細度の計算の対象になりません。ブラウザによりますが、これはグレーアウトされなくなるか、あるいは<em>すべて</em>の<code>ERROR</code>宣言がグレーアウトになるということです。これで問題が少し改善されます。私が気に入っているのは、Chromeが認識されないプロパティをハイライトするために、その頭に小さな警告サイン（⚠）を付けてくれることです。エラーをハイライトするのに役立つサインが自動的に取り入れられて、以下ような感じになります。</p><p>Chrome開発ツールのCSS宣言ブロック。エラー宣言が打ち消し線スタイルで表示されています。</p><p>残念ながら、上書きされた宣言と同様に、認識されない宣言にも図のように打ち消し線のスタイルが適用されます。だからといって、ぶち壊しにはなるわけではないというのが私の考えです。大文字のプロパティ名<code>ERROR</code>は、宣言をかなり明確に際立たせてくれます。とはいえ、<a href="https://twitter.com/dansketchpad"><span class="link">ダン・スミス（Dan Smith）</span></a><sup><a href="#fn27_14"><span class="sup_link">（脚注205）</span></a></sup>の助けを借りて、<a href="https://github.com/Heydon/css-error-property-style/blob/master/README.md"><span class="link">ちょっとしたChrome拡張</span></a><sup><a href="#fn27_15"><span class="sup_link">（脚注206）</span></a></sup>を用意してみました。これで打ち消し線を取り除き、赤地に白文字というエラーらしい見た目に置き換えることができます。</p><p><img src="images/dev_tools_3.png" alt="エラー宣言に、赤地に白文字というスタイルが適用されている。警告サインも依然として表示されている。" /><br /><em>エラー宣言に、赤地に白文字というスタイルが適用されています。警告サインも依然として表示されています。</em></p><p>認識されないプロパティを含むあらゆる宣言に対して、このスタイルが適用される点に注意してください。ただし、ありがたいことに、この拡張機能では<code>.has-ignorable-error</code>クラスを除外しているおかげで、もっとも一般的な認識されないプロパティ――ブラウザプレフィックス――にはこのスタイルが適用されないようになっています。</p><pre><code class=" language-css"><span class="token selector">.overloaded.not-parsed-ok.inactive:not(.has-ignorable-error) </span><span class="token punctuation">{</span>
    <span class="token property">text-decoration</span><span class="token punctuation">:</span> none <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> red <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.overloaded.not-parsed-ok.inactive:not(.has-ignorable-error) .webkit-css-property </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #fff <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><h3>ひとつにまとめる</h3><p>タブインターフェイスのパターンが<em>tab-interface.css</em>というファイルになるとしたら、命名規則に従い、<em>tab-interface.test.css</em>というファイルを付随させます――以下のような内容です。</p><pre><code class=" language-css"><span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;支援技術に認識されるために、タブインターフェイスである&lt;ul>にはtablist WAI-ARIAロールを指定しなければなりません。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;支援技術にタブと見なされるために、tablist内の&lt;a>要素にはそれぞれtab WAI-ARIAロールを指定しなければなりません。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;WAI-ARIA presentationロールを指定して&lt;li>のセマンティクスを取り除いてください。タブインターフェイスである場合、これらのセマンティクスは不適切です。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;] </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;aria-selectedタブの-1というtabindex値を削除して、ユーザーがフォーカスできるようにし
てください。ユーザーはこのタブだけにはフォーカスを移動できる必要があります。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;選択されていないタブはすべて、tabindex値を-1とし、左右の矢印キーを使う方法でのみフォーカス可能にするべきです。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tabpanel&quot;]:not([aria-labelledby^=&quot;tab&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;各tabpanelには、「tab」で始まり、その後ろに対応するタブ番号が続くaria-labelledby属性を指定するべきです。これは、このインターフェイスにおけるタブシステムの運用規則です。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] ~ div:not([role=&quot;tabpanel&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;各タブパネルを、それをコントロールするtablistと正しく関連付けるために、明示的にtabpanel WAI-ARIAロールを指定する必要があります。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">[role=&quot;tablist&quot;] + div:not([role=&quot;tabpanel&quot;]) </span><span class="token punctuation">{</span>
    <span class="token property">ERROR</span><span class="token punctuation">:</span> <span class="token string">&quot;tablist直後の最初の要素は、tabpanel WAI-ARIAロールが指定されたタブパネルであるべきです。スクリーンリーダーユーザーが、選択したタブから開いたタブパネルへと直接移動できなければなりません。&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.tab-interface ul:not([role=&quot;tablist&quot;]),
[role=&quot;tablist&quot;] a:not([role=&quot;tab&quot;]),
[role=&quot;tablist&quot;] li:not([role=&quot;presentation&quot;]),
[role=&quot;tablist&quot;] a[aria-selected][tabindex=&quot;-1&quot;],
[role=&quot;tablist&quot;] a:not([aria-selected]):not([tabindex=&quot;-1&quot;]),[role=&quot;tabpanel&quot;]:not([aria-labelledby^=&quot;tab&quot;]),
[role=&quot;tablist&quot;] ~ div:not([role=&quot;tabpanel&quot;]),
[role=&quot;tablist&quot;] + div:not([role=&quot;tabpanel&quot;])
</span><span class="token punctuation">{</span>
    <span class="token property">outline</span><span class="token punctuation">:</span> 0.5em solid red<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p>もちろん、このままの形式でも、技術的にビルドに<em>失敗</em>するようなことはありません。これは単にフロントエンド開発者に見えるよう、エラーを視覚的にハイライトしているだけです。とはいえ、この<em>.test.css</em>ファイルは、間違いなく、本番環境には含めないほうがよいものです。<em>.test.css</em>の命名規則は、本番用ビルドのフォルダにコピーされないようにするのに役立ちます。</p><h2>ひとつで全てを賄う必要はない</h2><p>このテスト駆動マークアップのアプローチと、標準的な自動アクセシビリティテストとの違いははっきりしています。<a href="https://ffoodd.github.io/a11y.css/"><span class="link">a11y.css</span></a><sup><a href="#fn27_16"><span class="sup_link">（脚注207）</span></a></sup>などのCSSベースのブックマークレットを使っても、あるいは<a href="http://tenon.io/"><span class="link">tenon.io</span></a><sup><a href="#fn27_17"><span class="sup_link">（脚注208）</span></a></sup>などの高度なAPIを使っても、明らかになるのは一般的なエラーです。このような自動テストは、特にWCAGに準拠する場合には重要です。しかし、自分なりにカスタマイズしたパターンや構造のために独自のテストを書けば、期待する形式になっているかどうか、よりきめ細かく、詳細にテストすることができます。</p><p>タブインターフェイスの実装はさまざまです。たとえば、タブとタブパネルのリレーションシップを、<code>aria-labelledby</code>ではなく<code>aria-controls</code>を使って構築することもできます。ここで書いたテストは、<em>私</em>の実装――私ならではのパターン――が所定の構造になっていることを確認するためのものです。追加のJavaScriptフックやCSSフック（<code>data</code>属性や<code>class</code>属性）が必要が場合、それらをテストすることもできます。</p><p>インクルーシブデザインパターンの独自ライブラリを開発する際は、ここで紹介したようなテストをいくつか書いてみることをお勧めします。パターンが時間の経過とともに、そして同僚や仲間たちの手を経るなどして進化していく中で、完全性が保たれていることを確認できます。エラーが発生すれば、なぜその構造を選択したのか、その構造がいかにインクルーシブであるのかを――そのエラーメッセージを通じて――説明する、絶好の機会になります。</p><div class="fn_overview"><p class="separator">—</p><p id="fn27_1"><span class="fn_number">1.</span><a href="https://en.wikipedia.org/wiki/Test-driven_development"><span class="fn_link">https://en.wikipedia.org/wiki/Test-driven_development</span></a></p><p id="fn27_2"><span class="fn_number">2.</span><a href="https://mochajs.org"><span class="fn_link">https://mochajs.org</span></a></p><p id="fn27_3"><span class="fn_number">3.</span><a href="http://chaijs.com/"><span class="fn_link">http://chaijs.com/</span></a></p><p id="fn27_4"><span class="fn_number">4.</span><a href="http://emmet.io/"><span class="fn_link">http://emmet.io/</span></a></p><p id="fn27_5"><span class="fn_number">5.</span><a href="https://shop.smashingmagazine.com/products/apps-for-all"><span class="fn_link">https://shop.smashingmagazine.com/products/apps-for-all</span></a></p><p id="fn27_6"><span class="fn_number">6.</span><a href="http://heydonworks.com/practical_aria_examples/#tab-interface"><span class="fn_link">http://heydonworks.com/practical_aria_examples/#tab-interface</span></a></p><p id="fn27_7"><span class="fn_number">7.</span><a href="https://www.w3.org/TR/wai-aria/roles#tablist"><span class="fn_link">https://www.w3.org/TR/wai-aria/roles#tablist</span></a></p><p id="fn27_8"><span class="fn_number">8.</span><a href="http://w3c.github.io/aria/aria/aria.html#aria-selected"><span class="fn_link">http://w3c.github.io/aria/aria/aria.html#aria-selected</span></a></p><p id="fn27_9"><span class="fn_number">9.</span><a href="https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors"><span class="fn_link">https://developer.mozilla.org/en/docs/Web/CSS/General_sibling_selectors</span></a></p><p id="fn27_10"><span class="fn_number">10.</span><a href="https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors"><span class="fn_link">https://developer.mozilla.org/en/docs/Web/CSS/Adjacent_sibling_selectors</span></a></p><p id="fn27_11"><span class="fn_number">11.</span><a href="http://heydonworks.com/revenge_css_bookmarklet/"><span class="fn_link">http://heydonworks.com/revenge_css_bookmarklet/</span></a></p><p id="fn27_12"><span class="fn_number">12.</span><a href="https://ffoodd.github.io/a11y.css/"><span class="fn_link">https://ffoodd.github.io/a11y.css/</span></a></p><p id="fn27_13"><span class="fn_number">13.</span><a href="https://twitter.com/ffoodd_fr"><span class="fn_link">https://twitter.com/ffoodd_fr</span></a></p><p id="fn27_14"><span class="fn_number">14.</span><a href="https://twitter.com/dansketchpad"><span class="fn_link">https://twitter.com/dansketchpad</span></a></p><p id="fn27_15"><span class="fn_number">15.</span><a href="https://github.com/Heydon/css-error-property-style/blob/master/README.md"><span class="fn_link">https://github.com/Heydon/css-error-property-style/blob/master/README.md</span></a></p><p id="fn27_16"><span class="fn_number">16.</span><a href="https://ffoodd.github.io/a11y.css/"><span class="fn_link">https://ffoodd.github.io/a11y.css/</span></a></p><p id="fn27_17"><span class="fn_number">17.</span><a href="http://tenon.io/"><span class="fn_link">http://tenon.io/</span></a></p></div></div></body></html>
