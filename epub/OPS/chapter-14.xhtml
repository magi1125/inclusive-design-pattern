<?xml version='1.0' encoding='UTF-8' ?>
<html xml:lang="ja" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8"/><title>パターンごとの評価 | インクルーシブHTML+CSS &amp; JavaScript1</title><link rel="stylesheet" href="css/book.css" type="text/css"/><meta name="EPB-UUID" content="24CC751A-5435-483D-851C-00DC23A33E17"/></head><body><div class="body"><h1>パターンごとの評価</h1><p>本書の執筆に着手したとき、私は最初にラフなアウトラインを作りました。この骨組みは、テーマや原則を中心に構成したものでした。つまり、この章はキーボードインタラクションについて書く、別の章は色について、また別の章はライティングについて、という具合に書き出していったのです。</p><p>このように準備するのはよいことですが、やり方はよく考えたほうがいいでしょう。私の場合、いくつかの章を実際に書いてみると、すぐにこの構造に問題があったことがわかりました。私の直感的な考え方や作業方法に合っていなかったのです。</p><p>問題は、何かをキーボードでアクセスできるようにする方法について説明しようと思ったときに、タッチ操作やスクリーンリーダーの互換性、コピーライティングなどについて触れないようにしなくてはならなかったことです。何かをインクルーシブにする方法について、あるひとつの点についてのみ詳しく説明し、害になる可能性がある他の問題について何も説明しないのは適切でないと感じました。それでは中途半端なまま放り出したことになってしまうでしょう。</p><p>インターフェイスをデザインするときは、抽象的な原則を扱うのではなく、機能する<em>もの</em>を作ります。その呼び方は<em>モジュール</em>、<em>コンポーネント</em>、もっとゆるく言えば<em>パターン</em>など、場合によって変化しますが、ともあれインターフェイスを構成する部品を意味します。</p><p>パターンを作るとき、何かひとつの原則に基づいて組み立てるということはありません。キーボードでアクセスできるパターンというものや、国際化されたパターンというものを作るわけではないのです。作りたいのは、<em>すべての</em>良い特性を備え、当然、悪い特性をまったくもたないパターンです。</p><p>私は、原則ごとのインクルージョンという当初もくろんでいた構造には早々に見切りをつけて、個々のパターンについて説明することにしました――うまく機能しているWebサイトやアプリケーションに見られるモチーフやコンポーネントをとりあげることにしたのです。基本的には、私自身のデザインプロセスを文章にすれば良いわけですから、すらすらと筆が進み始めました。インクルーシブなコンテンツや機能を考え、実現するという作業を書いていったのです。デザイナー、開発者、制作者であるみなさんには、この方がより明確で、伝わりやすいだろうと考えました。</p><h2>原則ごとの評価における問題点</h2><p>本書を原則ごとに書き始めたのは、私がアクセシビリティエンジニアの帽子をかぶってアクセシビリティ診断を行うことがよくあるからです。Webサイトやアプリケーションのアクセシビリティを評価し、問題を特定し、治療法をアドバイスします。そして修正するのです。</p><p>診断を実施する際、私はWCAG（Web Content Accessibility Guidelines）に従います。国によっては独自のアクセシビリティ法を持っていることもありますが、WCAGは事実上の国際標準となっており、標準化団体であるW3Cによって承認されています。大体において、<em>私は</em>そのインターフェイスはこうデザインすべきだったと思う、と伝える<em>だけ</em>ではないほうがよいのです。</p>
<div class="translator_note" id="translator_note1377"><h3>訳註</h3><p>「事実上の」とありますが、2012年にISO/IEC40500:2012としてISO規格にもなっています。</p></div>
<p>WCAGが4つの原則――<em>知覚可能</em>、<em>操作可能</em>、<em>理解可能</em>、<em>堅牢性</em>――ごとに整理されているのは当然のことです。WCAGは、皆さんがどのような要素、構造、慣習を採用するかを事前に把握できないので、抽象的にならざるを得ないのです。しかしその結果、手動で評価を行うエキスパートも、自動化されたテストツールも、結果を原則に照らしあわせて<em>レポート</em>するようになりました。</p><p>原則ごとにアクセシビリティの不備をレポートするのは、そのほうが、問題すべてをカバーしていることを保証しやすいからです。しかし、このように問題を示されて、開発チームは容易に対応できるのでしょうか。開発者がコンポーネントの結合テストの結果を受けて必死で対応しているときに、アプリケーション全体で代替テキストが欠落しているというチケットが100件登録されたとして、一体何の役に立つというのでしょう。</p><p><img src="images/alt_text_tickets.png" alt="バグとタグづけされたチケットのリスト。ページ上の問題のある代替テキスト：102件［バグ］、ページ上の代替テキストの不足：66件［バグ］、ページ上の不適切な代替テキスト：94件［バグ］、ページ上の代替テキストの欠如：29件［バグ］、ページ上の代替テキストの不具合：84件［バグ］"/><br/><em>やれやれ! ヘッドフォンでナパーム・デスでも聴こうか。</em></p><p>それだけではありません。多くの場合、一見すると1つの原則やテーマに属している問題は、他の問題と関連しています――因果関係や、相互関係があるのです。1つの残念なデザインの事例を、わざわざ2つ以上の課題に分けて報告することは、修正プロセスを複雑にするだけです。また、これらの問題が実際にどのようにして発生したかを開発者に教育する効果もありません。</p><h3>ボタンの例（再掲）</h3><p>1章「はじめに」で紹介したボタンの例をもう一度見てみましょう。ただし今回は、このボタンもどきが、コンテンツに賛成票を投じるためのものという想定です。</p><p>ボタンのマークアップは以下のようになっています。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><p>ボタンの見た目はこのようになっています。</p><p><img src="images/upvote_button.png" alt="左側に親指を立てたアイコン、右側に「賛成！」という文字が配置されたボタン。"/></p><p><code>class</code>属性と<code>data-action</code>属性を別々に指定し、スタイルとふるまいを分離したのはすばらしいのですが、インクルーシブという観点で見ると、重大な問題はほとんど解決できていません。</p><p>WCAGに照らして、それぞれの問題がどの達成基準を満たしていないのか確認していきましょう。まず、<em>知覚可能</em>の観点では、背景として敷かれた文字画像に代替テキストがないため、このボタンは<a href="https://www.w3.org/TR/WCAG20/#text-equiv"><span class="link">1.1.1「非テキストコンテンツ」</span></a>を満たしていません。次に、<em>操作可能</em>の観点では、このボタンは<a href="https://www.w3.org/TR/WCAG20/#keyboard-operation"><span class="link">2.1.1「キーボード」</span></a>を満たしていません。<code>&lt;div&gt;</code>要素はフォーカスできませんし、たとえ<code>tabindex="0"</code>でフォーカス可能にしたとしても、<em>Enter</em>や<em>Space</em>キーを押してクリックイベントをトリガーするためにはJavaScriptが必要になります。最後に、<em>堅牢性</em>の観点では、<a href="https://www.w3.org/TR/WCAG20/#ensure-compat"><span class="link">4.1.2「名前（name）・役割（role）及び値（value）」</span></a>を満たしていません。支援技術に対して、このボタンが実際にボタンであると伝わるようなマークアップはされていないからです。</p><h3>ボタンの修正</h3><p>さて、アクセシビリティコンサルタントが、これらの問題すべてを原則と達成基準ごとに整理してスプレッドシートにまとめ、レポートしたとしましょう。その後、そのスプレッドシートはクライアントのプロジェクトマネージャーに手渡され、開発者に渡すバグチケットが作られます。</p><p>ある開発者には、無作為に「賛成ボタンのラベル欠如」というチケットが割り当てられました。開発者はチケットを開き、誇りある開発者ならだれでもそうするように、修正を行ってチケットをクローズするべく努力します。その開発者は、アクセシブルな名前 (accessible name) をつける技術に特に詳しいわけではなかったので、軽く調べて、現実的な解決策をいくつか見つけます。テキストノードを追加するのはアウトです。背景にある文字画像の上にテキストが重なって表示されてしまいます。いろいろ考えた結果、<code>aria-label</code>を使うことにしました。</p>
<div class="translator_note" id="translator_note1408"><h4>訳註</h4><p>「アクセシブルな名前 (name)」とは、支援技術などにこのコントロールが何であるのかを伝えるためのテキストです。ここでは、ボタンにつける「賛成!」というラベルが該当します。button要素の場合、単純に &lt;button&gt;賛成!&lt;/button&gt; とマークアップされていれば、このテキストはラベルとして表示されると同時に「アクセシブルな名前 (name)」としても機能します。</p><p>「アクセシブルな名前 (name)」については、2章「ドキュメント全体」も参照してください。</p><h5>参考</h5><ul><li><a href="http://waic.jp/docs/WCAG20/Overview.html#namedef">Web Content Accessibility Guidelines (WCAG) 2.0 - 名前 (name)</a></li></ul></div>
<pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span>"賛成！"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><p>この開発者が知らぬうちに、別の開発者には「賛成ボタンがキーボードでアクセスできない」というチケットが割り当てられています。このチケットには、<code>tabindex</code>を使って<code>&lt;div&gt;</code>にキーボードでアクセスできるようにする方法と、キーボードでクリックイベントをトリガーするJavaScriptについて、アクセシビリティコンサルタントからのアドバイスが添えられています。プロジェクトのJavaScriptがわずかに増え、マークアップは以下のようになります。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span>"賛成!"</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>"0"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><p>そうこうしている間に、3人めの開発者は「賛成ボタンのロールが不適切」というチケットについて律儀に検討して、――すでに<code>&lt;div&gt;</code>に加えられた修正を確認した上で――<code>“button”</code>という明確なARIAロールを加えて仕上げます。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span>"賛成!"</span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span>"0"</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span>"button"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><h3>より良い方法</h3><p><code>&lt;div&gt;</code>をボタンコントロールとして使うような、単純に<em>まずいアイデア</em>を指摘したり避けたりする機会がないと、不自然かつ断片化された方法でインターフェイスを評価することになってしまいます。達成基準ごとに断片化して欠陥を報告し、開発者に作業を割り当てると、どうしてもすでに存在するものにパッチを当てるだけになってしまいます。そしてたいていの場合、コードが肥大化して堅牢性が低下するという結果になります。</p><p>代わりにパターンを使ってレポートすれば、コンサルタントは別のアプローチやテクニックをすすめる機会が持てます。このケースでは、<em>賛成ボタンのパターン</em>という項目にまとめられたさまざまな欠陥を見れば、コンサルタントは当然ながら標準の<code>&lt;button&gt;</code>要素を使うようすすめるはずです。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span>"賛成！"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre><p>コンサルタントは、このデザインし直したパターンをさらに完成に近づけるため、アイコンにSVGを使うことをすすめるかもしれません。7章「メニューボタン」で説明するように、SVGには拡大縮小できてファイルサイズが小さいというメリットがあります。また――アイコンフォントとは異なり――ユーザーのフォント選択によって破綻することもありません。</p><pre><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-action</span><span class="token attr-value"><span class="token punctuation">=</span>"upvote"</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span>"賛成！"</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span>"#upvote"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>use</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code></pre><p>モジュールやコンポーネントといった考え方に慣れた開発者にとって、これは問題に対する完全かつ総合的なソリューションとなるでしょう。アクセシビリティコンサルタント（報告者）は、開発者と同じ土俵に立って、わかりやすく具体的な方法でインターフェイスを改善する手助けができました。</p><p>それだけではありません。インクルーシブな賛成ボタンが古い実装にとって代わった結果、コンサルタントは組織のパターンライブラリの改善を支援することもできたのです。次に賛成ボタン（または似たようなもの）が必要になったとき、開発者にはすぐに使える見本があります。これは現在のプロジェクトにも、将来のプロジェクトにも当てはまります。</p><p><img src="images/enhancement_tickets.png" alt="単なる課題としてではなく、パターン名と共に「拡張」とタグ付けされたチケット。賛成ボタン［拡張］、ログイン画面［拡張］、ユーザーアカウントのウィジット［拡張］、タブシステム［拡張］"/><br/><em>パターン別に整理されたチケットは、パターンライブラリと簡単に調和させることができます。</em></p><p>ジョー・ドルソン（Joe Dolson）が<a href="https://www.joedolson.com/2016/01/im-an-accessibility-consultant-stop-hiring-me/"><span class="link">「I’m an accessibility consultant. Stop hiring me」</span></a>で述べているように、破綻したWebサイトやアプリケーションを修正するのは、コンサルタントとクライアントの双方にとって嫌な作業です。はじめからインクルーシブな製品を<em>デザイン</em>するためのトレーニングや教育の方がはるかに効果的で有益です。パターンごとの修正は、修正プロセスにデザインの考え方をもたらします。クライアントが現在の製品を修正するのを手助けするだけでなく、将来的にインクルーシブデザインに関する判断を下す際にも迷いがなくなります。</p><p>そうなれば、アクセシブルでないものを修正するという私の役割も、もはや必要なくなるでしょう。ジョーと同じく、私としても望むところです。</p><h2>Custom ElementsとShadow DOM</h2><p>これはおそらくインクルージョンとWeb Componentsの問題に取り組むのにうってつけのトピックでしょう。多くの組織がパターンの構成に<a href="https://github.com/w3c/webcomponents"><span class="link">Web Componentsの仕様</span></a>を取り入れ始めています。今までと何が違い、追加で何をしなければならなくなったのか、インクルーシブデザインの観点から検討していきましょう。Web Componentsの4つの機能、Shadow DOM、Custom Elements、HTML Imports、HTML Templatesの中で、直接的に問題を引き起こす可能性があるのは<a href="https://w3c.github.io/webcomponents/spec/custom/"><span class="link">Custom Elements</span></a>と、（影響は小さめですが）<a href="https://w3c.github.io/webcomponents/spec/shadow/"><span class="link">Shadow DOM</span></a>のみです。両者は、ユーザーがインターフェイスを操作したときの動作に影響を与えます。</p><p>Custom Elementsの利点は、カスタマイズしたスタイルやふるまいを、自分で設計した独自要素に結びつけられることです。たとえば、トグルボタンのコードを一式書いて、それを<code>&lt;toggle-button&gt;</code>要素にアタッチできます。わかりやすい名前の、すっきりした機能をパッケージにできるのです。</p><pre><code class="language-javascript"><span class="token comment">// Custom Elements v0 の構文
</span>document<span class="token punctuation">.</span>registerElement<span class="token punctuation">(</span><span class="token string">'toggle-button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> toggleButton
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">
// Custom Elements v1 の構文
</span>customElements<span class="token punctuation">.</span>define<span class="token punctuation">(</span><span class="token string">'toggle-button'</span><span class="token punctuation">,</span> toggleButton<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>（<strong>注：</strong>Custom Elementsのバージョン0と1の比較は、ショーン・アレン（Shawn Allen）の「<a href="https://github.com/shawnbot/custom-elements"><span class="link">All about HTML Custom Elements</span></a>」を参照してください。）</p><p>この新しい要素は、<code>registerElement</code>または<code>customElements.define</code>をサポートしているブラウザでは適切な要素として扱われますが、<code>&lt;button&gt;</code>要素の標準的なふるまいは備えていません。言い換えれば、<a href="https://developer.mozilla.org/en/docs/Web/API/HTMLButtonElement"><span class="link"><code>HTMLButtonElement</code></span></a>プロトタイプのインスタンスではないということです。実際のところ、これは単なる<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement"><span class="link"><code>HTMLElement</code></span></a>のインスタンスにすぎず、<code>&lt;div&gt;</code>のようなものです。</p><p>ここまで読み進めたみなさんには、それが何を意味するかおわかりでしょう。フォーカスできず、押しても動作せず、スクリーンリーダーでボタンであることを知らせる<code>button</code>ロールも持っていないボタン――つまり先ほど説明した、修正を加えた<code>&lt;div&gt;</code>ボタンと同じようなものだということです。</p><p>Custom Elementsの場合、それらのふるまいをもっとすっきりと、堅牢な方法で追加することができます。Custom Elements v0を使う場合、それらのふるまいを<a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/#lifecycle"><span class="link"><code>createdCallback</code>という lifecycle callback メソッド</span></a>に追加します。</p><pre><code class=" language-javascript">toggleButton<span class="token punctuation">.</span>createdCallback <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// キーボートフォーカスを受け入れる
</span>    this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'tabindex'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// アクセシビリティツリー内でこの要素がボタンとして表現されるようにする
</span>    this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// キーボードによるクリックイベントのディスパッチ
</span>    this<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">13</span> <span class="token operator">||</span> event<span class="token punctuation">.</span>keyCode <span class="token operator">==</span><span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> click <span class="token operator">=</span> <span class="token keyword">new</span> MouseEvent<span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token string">'view'</span><span class="token punctuation">:</span> this<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">.</span>defaultView<span class="token punctuation">,</span>
                <span class="token string">'bubbles'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token string">'cancelable'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            this<span class="token punctuation">.</span>dispatchEvent<span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>このトグルボタンをオフの（押されていない）状態で初期化するため、<code>aria-pressed="false"</code>も追加します。</p><pre><code class=" language-javascript">this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>このように、要素の定義の中に属性やふるまいの指定を追加することで、コードがすっきりと見やすいものになります――制作者はただ、<code>&lt;toggle-button&gt;</code>のインスタンスを作るだけでよいのです。あとは、<code>click</code>イベントで状態が切り替わるようにするだけです。まず、<code>createdCallback</code>の中にイベントリスナーを追加します。</p><pre><code class=" language-javascript">this<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  this<span class="token punctuation">.</span>toggle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>次に、<code>toggle()</code>メソッドの実体を作る必要があります。以下のコードを所定の場所に追加すると、<code>click</code>イベントが発生するか、<code>toggleInstance.toggle()</code>をスクリプトから呼んだ際に、状態が変化するようになります（<code>toggleInstance</code>が<code>&lt;toggle-button&gt;</code>のインスタンスの場合）。</p><pre><code class=" language-javascript">this<span class="token punctuation">.</span>toggle <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> isPressed <span class="token operator">=</span> this<span class="token punctuation">.</span>getAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
    this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token operator">!</span>isPressed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>セマンティクスとふるまいの観点では、この<code>&lt;toggle-button&gt;</code>は<code>&lt;button&gt;</code>のアクセシビリティ機能をすべて備えていることに加え、この要素自身が独自に定義したトグル機能も持っています。<code>&lt;button&gt;</code>と同様、アクセシビリティが<em>あらかじめ備わった</em>要素を作りました。つまり、キーボードやスクリーンリーダーのインクルージョンをいちいち考慮する必要がなく、単純にインターフェイスとして配置できるということです。</p><p><a href="http://codepen.io/heydon/pen/ZOqwqQ"><span class="link">このちょっとしたトグルボタンをCustom Elements v0を使用して実装するデモ</span></a>もあります。</p><p>もっと簡単に、まず<code>&lt;button&gt;</code>の基本機能を持たせてから、それを拡張するというやり方もあります。文字どおり、<code>HTMLButtonElement</code>プロトタイプを<em>拡張</em>するのです。ES2015/ES6構文でCustom Elements v1を使用すると、以下のように書くことができます。Custom Elements v1では<code>createdCallback</code>は必要ないことに注意してください。</p><pre><code class=" language-javascript">class ToggleButton extends HTMLButtonElement <span class="token punctuation">{</span>
  constructor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    this<span class="token punctuation">.</span>toggle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> isPressed <span class="token operator">=</span> this<span class="token punctuation">.</span>getAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
      this<span class="token punctuation">.</span>setAttribute<span class="token punctuation">(</span><span class="token string">'aria-pressed'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token operator">!</span>isPressed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    this<span class="token punctuation">.</span>addEventListener<span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      this<span class="token punctuation">.</span>toggle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span>define<span class="token punctuation">(</span><span class="token string">"toggle-button"</span><span class="token punctuation">,</span> ToggleButton<span class="token punctuation">,</span> <span class="token punctuation">{</span> extends<span class="token punctuation">:</span> <span class="token string">"button"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ご覧のとおり、<code>HTMLButtonElement</code>をベースにしているため、<code>tabindex</code>属性と<code>role</code>属性だけでなく、<code>keydown</code>イベントをディスパッチする見苦しいスクリプトも書かずにすみました。これは、最初にやろうとしていたことと同じです。つまり、元から使えるものをそのまま利用するのです。この方法は信頼性が高く、効率的で、そして単純に簡単でもあります。</p><h3>Shadow Boundary問題</h3><p>ほとんどの場合、インクルーシブなWeb Componentsの作成は、アクセシブルでセマンティックなHTMLをいつものように作り出しているにすぎません。ただ、それを新しいAPIの中で行っているだけです。ただし、注意が必要な顕著な違いが2つあります。ひとつはShadow Boundary（DOMツリー全体とShadow DOMとの間の境界）が<a href="https://www.w3.org/TR/wai-aria/states_and_properties#attrs_relationships_header"><span class="link">ARIAのリレーションシップ属性</span></a>に及ぼす影響、もうひとつは正の<code>tabindex</code>値です。</p><p>スティーブ・フォルクナー (Steve Faulkner) が「<a href="https://www.paciellogroup.com/blog/2014/03/stuff-doesnt-work-dom-shadow-dom/"><span class="link">Some stuff that doesn’t work between the DOM and Shadow DOM</span></a>」で書いているように、Shadow Boundaryは、<code>aria-labelledby</code>、<code>aria-describedby</code>、<code>aria-controls</code>などの属性で指定されたリレーションシップを分断してしまいます。</p>
<div class="translator_note" id="translator_note1508"><h4>訳註</h4><p>Shadow DOMはコンポーネントをカプセル化する技術です。これにより、コンポーネントが外部に影響を与えたり、外部の影響を受けたりしなくなるというメリットがあります。ここに書かれているように、コンテンツ側からはShadow DOMの内側の要素を参照できなくなりますが、それは同時に、コンテンツ側のスタイルが意図せずにコンポーネントに影響することを完全に防げるということでもあります。</p></div>
<p>すべてのCustom ElementsにはShadow DOMが含まれている、そしてShadow DOMはCustom Elementsでのみ使用できる、というのはよくある誤解です。両者は独立したテクノロジーです。先に挙げたトグルボタンの例はShadow DOMを使っていないので、<code>#toggleTarget</code>というIDの要素があれば、<code>aria-controls="toggleTarget"</code>で関連づけられます。Shadow DOMを採用すれば、それは不可能になるでしょう。</p><p><code>tabindex</code>に関しても、たとえば<code>tabindex="4"</code>はShadow DOM内の4番めのフォーカス順を意味することになり、親ドキュメント内の4番目のフォーカス順には<em>なりません</em>。これを便利に応用できることもあるかもしれませんが、いずれにしても、明示的に<code>tabindex</code>の順序を指定することはおすすめしません。理にかなったキーボード操作のためには、フォーカス順序はソースの順序に従うべきです。これを最も簡単に実践する方法は、暗黙的にフォーカス可能な要素と、そして――必要に応じて――<code>tabindex="0"</code>を指定した要素だけを使うことです。どちらも、ソースの順序に従ったデフォルトのフォーカス順序で配置され、Shadow DOMのサブツリーの影響を受けません。</p></div>
</body></html>